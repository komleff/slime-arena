# Progress
Отслеживание статуса задач.

## Контроль изменений
- **last_checked_commit**: main @ 3 января 2026
- **GDD версия**: v3.3.2
- **Резюме**: UX-улучшения (умения Собирателя, ввод, награды).

## Последние изменения

- **Выпуск v0.2.2:** добавлены workflow для публикации контейнеров и перевода пакетов в public, обновлен README, подготовлены заметки выпуска.
- **[P0 FIX] Залипание джойстика при активации умений (ПОЛНОЕ ИСПРАВЛЕНИЕ):** Корневая причина - браузеры генерируют compatibility mouse events на touch-устройствах, активируя `mouseState`. Решение: добавлен `if (isCoarsePointer) return;` в `onMouseMove` и `onMouseLeave`; `forceResetJoystickForAbility` теперь сбрасывает `mouseState.active = false`.
- **План рефакторинга архитектуры (Claude Opus 4.5):** Проведён анализ God Objects, создан `docs/Refactoring-Plan-Claude-Opus-4.5.md`. Выявлены критические проблемы: `ArenaRoom.ts` (4,026 строк), `main.ts` (4,958 строк), `config.ts` (2,982 строки). Оценка: 18-29 рабочих дней, 3 фазы.
- **Мобильный ввод:** блокировка масштабирования (maximum/minimum-scale, user-scalable=no) на время матча; защита от масштабирования жестами; защита от сенсорного ввода для кнопок умений.
- **Диагностика мобильного джойстика:** добавлены отладочные логи pointer/resize/visibility и кликов умений (флаг `?debugJoystick=1`).
- **Релиз v0.2:** публикация релиза и контейнеров в GHCR, ссылки добавлены в README.
- **Шаг 1:** Собиратель получил `pull` как стартовое умение, `slow` перенесено в общий пул карточек.
- **Шаг 2:** Притяжение орбов к пасти (getMouthPoint: 1.9 радиуса), визуализация смещена.
- **Шаг 3:** Мышь не активирует джойстик. Управление ПК: курсор задаёт направление.
- **Шаг 4:** Клик мышью по карточкам умений/талантов, добавлены подсказки.
- **Шаг 5:** Баланс движения обновлён: тяга вперёд +1.5x, боковая/ретро и угловая тяга -1.5x.
- **Шаг 6:** Награды сундуков - вспышка и всплывающий текст (с названием награды/таланта).
- **Награды сундуков:** при таланте показывается карточка рядом с описанием и редкостью на пару секунд.
- **Фикс ПК-клика по таланту:** выбор карточки не теряется при частых input-пакетах.
- **Карточки талантов/умений:** выбор вынесен в боковые панели и не мешает управлению; клик мышью на ПК работает.
- **Карточки выбора:** скрываются только при крупной потере массы, мелкие потери не сворачивают.
- **Параметры классов:** приведены к GDD (collector: `eatingPowerMult` = 1.25, `radiusMult` = 1; warrior: `biteResistPct` = 0).
- **Замечания ревью:** минимальная масса scatter-орбов согласована, исправлена визуализация точки притяжения.
- **Замечания проверки:** выбор карточек убран из `input`, сбрасывается `pendingLavaScatterMass`, очищаются `pendingChestRewards`.
- **Интерфейс и эффекты:** ограничение размера `pendingChestRewards`, вынесены константы шипов и цветов, общая функция редкости талантов, `chests.onRemove` использует позицию из `chest`, `.claude/` добавлена в `.gitignore`.
- **Баланс:** отключены неработающие таланты `sense`, `regeneration`, `momentum`, `berserk`, `symbiosis`; `turnTorqueNm` = 24000 для всех `slimeConfigs`.
- **Known Issues 11.1-11.4:** Сетка ярче, поле обзора x2, шипастые препятствия с шипами и ⚠, scatter-орбы min 5 кг.
- **Документация:** GDD обновлен до версии 3.3.2 (все документы синхронизированы).

## Открытые задачи (feat/ux-improvements)
- [x] Шаг 1: Собиратель — смена умения.
- [x] Шаг 2: Притяжение орбов к пасти.
- [x] Шаг 3: Отключение джойстика для мыши.
- [x] Шаг 4: Клик мышкой по карточкам.
- [x] Шаг 5: Базовая тяга и угловой момент x2.
- [x] Шаг 6: Награды сундуков.
- [x] Known Issue 11.1: Сетка ярче + major-линии.
- [x] Known Issue 11.2: Поле обзора x2.
- [x] Known Issue 11.3: Шипастые препятствия с визуальными шипами.
- [x] Known Issue 11.4: Scatter-орбы min 5 кг.

**Все UX-улучшения и Known Issues завершены!**

## Открытые задачи (рефакторинг)

- [ ] Фаза 0.1: Типизация систем сервера (`room: any` → интерфейс)
- [ ] Фаза 0.2: Удаление дублирования mathUtils
- [ ] Фаза 1.1: Извлечение UI-компонентов из main.ts
- [ ] Фаза 1.2: Централизация стилей
- [ ] Фаза 2.1: Извлечение AbilityManager из ArenaRoom
- [ ] Фаза 2.2: Извлечение CombatManager из ArenaRoom
- [ ] Фаза 3.1: Разделение config.ts на модули
