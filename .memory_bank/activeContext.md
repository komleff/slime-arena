# Active Context

Текущее состояние проекта и фокус работы.

## Текущее состояние
**Ветка feat/gameplay-mvp-classes — 5 коммитов (27 декабря 2025)**

**GDD обновлён до v2.6.0** — крупное обновление баланса и механик.

### Последние коммиты:
- `bd2c9ee` fix: ability button UI (icon span, remove Q key) + tech debt update
- `884983c` feat: colored scatter orbs - victim class color
- `99685eb` feat: projectile ability (Выброс) - slot 1, key 2
- `db54cc1` feat: biteResistPct - Warrior bite resistance & Sweet/Hunger zones
- `043bc2f` fix: code review - shield flag, position:fixed, keys 2/3, GDD values

## Новые механики (текущая сессия)

### Colored Scatter Orbs (цветные пузыри урона)
При любом уроне (укус, снаряд) масса жертвы вылетает цветными пузырями:
| classId | Класс | Цвет scatter orbs |
|---------|-------|-------------------|
| 0 | Hunter | #4ade80 (зелёный) |
| 1 | Warrior | #f87171 (красный) |
| 2 | Collector | #60a5fa (синий) |

- colorId = classId + 10 для scatter orbs
- Визуальная обратная связь: видно кто получил урон по цвету пузырей

### biteResistPct (Сопротивление укусам)
| Класс | biteResistPct |
|-------|---------------|
| Hunter | 0 |
| Warrior | 0.15 (−15% потерь) |

- Применяется в `processCombat()` и `applyProjectileDamage()`
- Максимальный резист: 50% (cap)

### Projectile (Выброс) — Universal Ability Slot 1
| Параметр | Значение |
|----------|----------|
| Клавиша | 2 |
| Slot | 1 |
| Стоимость | 2% массы |
| Кулдаун | 3 сек |
| Скорость | 400 м/с |
| Дальность | 300 м |
| Урон | 10% массы цели |

**Механики:**
- Блокируется щитом (щит снимается)
- Триггерит Last Breath
- Scatter orbs 50% урона (цвет жертвы)

## Проверки
- ✅ npm run build — ok (126.42 kB gzip)
- ✅ npm run test (determinism) — passed

## GDD 2.6 — Ключевые изменения

### Классы
| Класс | Пассив | Стартовое умение |
|-------|--------|------------------|
| Охотник | +15% скорость, −15% урон укусом | Рывок |
| Воин | +20% урон укусом, −10% скорость | Щит |
| Собиратель | +25% массы от пузырей | Притяжение |

### Новые умения (слоты 2-3)
- **Плевок**: 3 снаряда веером, урон 8% каждый
- **Бомба**: AoE 50м, урон 12%
- **Отталкивание**: волна 80м, отбрасывает всех
- **Мина**: живёт 20сек, урон 15%

### Боевые изменения
- **Щит**: не снимается атакой (можно кусать под щитом)
- **Притяжение**: замедляет слаймов на 30%
- **Пасть в пасть**: тяжёлый побеждает при разнице >10%
- **Смерть**: токсичная лужа + 6-8 мелких пузырей (вместо 3)

### 5 типов зон
| Зона | Эффект |
|------|--------|
| Нектар | +1% массы/сек |
| Лёд | ×0.3 трение |
| Слизь | ×0.5 скорость |
| Лава | −2% массы/сек |
| Турбо | ×1.4 скорость |

### Классовые таланты (по 3 уникальных)
- **Охотник**: Засада, Погоня, Невидимка
- **Воин**: Несокрушимый, Шипы, Берсерк
- **Собиратель**: Паразит, Магнит, Симбиоз

## Следующие шаги

### Приоритет 1 (текущий PR #7)
- [ ] Review и merge PR #7
- [ ] Исправление техдолга (PvP mass calculation)

### Приоритет 2 (GDD 2.6 — Бой)
- [ ] Механика «пасть в пасть» (тяжёлый побеждает)
- [ ] Щит не снимается при атаке
- [ ] Притяжение замедляет слаймов
- [ ] Токсичная лужа при смерти
- [ ] 6-8 мелких пузырей вместо 3

### Приоритет 3 (GDD 2.6 — Умения)
- [ ] Плевок (3 снаряда веером)
- [ ] Бомба (AoE)
- [ ] Отталкивание (волна)
- [ ] Мина (ставится на землю)

### Приоритет 4 (GDD 2.6 — Зоны и Таланты)
- [ ] 5 типов зон (Нектар, Лёд, Слизь, Лава, Турбо)
- [ ] Система талантов (30 талантов)
- [ ] Классовые уникальные таланты
- [ ] Hot Zones с индикаторами
