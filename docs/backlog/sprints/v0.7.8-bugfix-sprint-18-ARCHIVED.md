# –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤ v0.7.8

**–î–∞—Ç–∞:** 2026-02-03
**–í–µ—Ä—Å–∏—è:** 0.7.7 ‚Üí 0.7.8
**–í–µ—Ç–∫–∞:** `sprint-18/tech-debt-reduction`
**PM:** Claude Opus 4.5

---

## Scope

### –ë–∞–≥–∏ –∏–∑ production-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

| ID | P | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|----|---|----------|--------|
| `slime-arena-zk6u` | P2 | WebSocket spam –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω |
| `slime-arena-bgbp` | P1 | Play Again –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ Results | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω |
| `slime-arena-euy3` | P2 | 403/404 –Ω–∞ /match-results/claim –¥–ª—è –≥–æ—Å—Ç–µ–π | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω |

### PR #124 (—É–∂–µ –≥–æ—Ç–æ–≤)

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è reverse proxy (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MetaServer URL)
- –í–µ—Ä—Å–∏—è 0.7.8 —É–∂–µ –≤ version.json

---

## –ê–Ω–∞–ª–∏–∑ –±–∞–≥–æ–≤

### 1. WebSocket spam (`slime-arena-zk6u`) ‚Äî P2

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∞—Ç—á–∞ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ø–∞–º–∏—Ç—å `send()` –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–π WebSocket (—Å–æ—Ç–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏).

**–ü—Ä–∏—á–∏–Ω–∞:** Game loop –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –§—É–Ω–∫—Ü–∏—è `send()` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- `client/src/main.ts` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ `Hn`, `fn`, `Zt` (–º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –≤ production)
- –ò—Å–∫–∞—Ç—å: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `room.onLeave`, `room.onError`, –ø—Ä–æ–≤–µ—Ä–∫—É `readyState`

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `room.connection.isOpen` –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º `send()`
2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å game loop –ø—Ä–∏ `onLeave`/`onError`
3. –û—á–∏—Å—Ç–∏—Ç—å interval/animation frame –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### 2. Play Again –∑–∞–≤–∏—Å–∞–µ—Ç (`slime-arena-bgbp`) ‚Äî P1

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞" —ç–∫—Ä–∞–Ω Results –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞ –∑–∞–≤–∏—Å–∞–µ—Ç.

**–ü—Ä–∏—á–∏–Ω–∞:** –°–≤—è–∑–∞–Ω–æ —Å WebSocket spam ‚Äî –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ —Å—Ç–∞—Ä—ã–π game loop –µ—â—ë –∞–∫—Ç–∏–≤–µ–Ω. –í–æ–∑–º–æ–∂–µ–Ω race condition –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º room.

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- `client/src/main.ts` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è `connectToServer()`, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Play Again
- `client/src/ui/screens/ResultsScreen.ts` ‚Äî –ª–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–æ–º–Ω–∞—Ç—É –ø–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –Ω–æ–≤–æ–π
2. –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `isConnecting` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
3. –°–±—Ä–æ—Å–∏—Ç—å UI state –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á–∞

### 3. 403/404 –Ω–∞ claim (`slime-arena-euy3`) ‚Äî P2

**–°–∏–º–ø—Ç–æ–º:**
- 403 Forbidden –ø—Ä–∏ –ø–µ—Ä–≤–æ–º claim (–≥–æ—Å—Ç—å –Ω–µ –ø–µ—Ä–≤—ã–π –≤ –º–∞—Ç—á–µ)
- 404 Not Found –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –º–∞—Ç—á–∞—Ö (match_results –Ω–µ submitted)

**–ü—Ä–∏—á–∏–Ω–∞:**
- `match_results.guest_subject_id` —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ ID –ø–µ—Ä–≤–æ–≥–æ –≥–æ—Å—Ç—è
- –î—Ä—É–≥–∏–µ –≥–æ—Å—Ç–∏ –ø–æ–ª—É—á–∞—é—Ç 403 –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤–ª–∞–¥–µ–Ω–∏—è
- –ü—Ä–∏ Play Again matchId –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- `server/src/meta/routes/matchResults.ts` ‚Äî —Å—Ç—Ä–æ–∫–∞ 321, –ø—Ä–æ–≤–µ—Ä–∫–∞ `guest_subject_id`
- `server/src/rooms/ArenaRoom.ts` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–∞—Ç—á–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è: –∏—Å–∫–∞—Ç—å –≥–æ—Å—Ç—è –≤ `playerResults` –ø–æ `guestSubjectId`
2. –£–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É `guest_subject_id !== subjectId`
3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Phase 1: WebSocket cleanup (–∫—Ä–∏—Ç–∏—á–Ω–æ)

1. **–ù–∞–π—Ç–∏ game loop** –≤ `main.ts`:
   - –ò—Å–∫–∞—Ç—å `requestAnimationFrame`, `setInterval`
   - –ù–∞–π—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `room.onLeave`, `room.onError`

2. **–î–æ–±–∞–≤–∏—Ç—å guard –≤ send()**:
   ```typescript
   if (!room || !room.connection?.isOpen) {
     return;
   }
   ```

3. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å loop –ø—Ä–∏ disconnect**:
   ```typescript
   room.onLeave(() => {
     cancelAnimationFrame(animationFrameId);
     clearInterval(tickIntervalId);
   });
   ```

### Phase 2: Play Again fix

1. **–î–æ–±–∞–≤–∏—Ç—å cleanup –ø–µ—Ä–µ–¥ reconnect**:
   ```typescript
   async function playAgain() {
     if (currentRoom) {
       await currentRoom.leave();
       currentRoom = null;
     }
     await connectToServer();
   }
   ```

2. **–°–±—Ä–æ—Å–∏—Ç—å UI state**:
   - `gameState.phase = 'menu'`
   - –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Phase 3: Claim fix (—Å–µ—Ä–≤–µ—Ä)

1. **–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–ª–∞–¥–µ–Ω–∏—è** –≤ `matchResults.ts:319-338`:
   - –î–ª—è –≥–æ—Å—Ç–µ–π: –∏—Å–∫–∞—Ç—å –≤ `playerResults` –ø–æ `guestSubjectId`
   - –ù–µ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ `guest_subject_id` (–æ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≥–æ—Å—Ç—è)

2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ claim
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ/–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã

1. ‚úÖ PR #124 —É–∂–µ –≥–æ—Ç–æ–≤ ‚Äî —Å–º–µ—Ä–∂–∏—Ç—å
2. üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å `slime-arena-zk6u` (WebSocket spam)
3. üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å `slime-arena-bgbp` (Play Again) ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç #1
4. üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å `slime-arena-euy3` (claim 403/404)
5. üì¶ –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ 0.7.8
6. üöÄ –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ VPS

---

## –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

### –¢–µ—Å—Ç—ã –¥–ª—è WebSocket spam:
1. –°—ã–≥—Ä–∞—Ç—å –º–∞—Ç—á –¥–æ –∫–æ–Ω—Ü–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å ‚Äî –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π "WebSocket is already in CLOSING"
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å 3 —Ä–∞–∑–∞

### –¢–µ—Å—Ç—ã –¥–ª—è Play Again:
1. –°—ã–≥—Ä–∞—Ç—å –º–∞—Ç—á
2. –ù–∞–∂–∞—Ç—å "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"
3. –ù–æ–≤—ã–π –º–∞—Ç—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∞—Ç—å—Å—è –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏—è
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å 5 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥

### –¢–µ—Å—Ç—ã –¥–ª—è claim:
1. –°—ã–≥—Ä–∞—Ç—å –º–∞—Ç—á –∫–∞–∫ –≥–æ—Å—Ç—å (–Ω–µ –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫)
2. –ù–∞–∂–∞—Ç—å "–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—ã"
3. –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 403/404

---

## –†–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|-----------|
| –†–µ–≥—Ä–µ—Å—Å–∏—è –≤ multiplayer | –°—Ä–µ–¥–Ω—è—è | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å 2+ –∏–≥—Ä–æ–∫–∞–º–∏ |
| –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –Ω–∞—Ä—É—à–µ–Ω | –ù–∏–∑–∫–∞—è | –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test` |
| OAuth —Å–ª–æ–º–∞–Ω | –ù–∏–∑–∫–∞—è | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å |

---

## –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**Developer:** Claude Opus 4.5
**Reviewer:** –ë—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –ø–æ—Å–ª–µ PR
**–≠—Å–∫–∞–ª–∞—Ü–∏—è:** –ü—Ä–∏ 3+ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö ‚Üí ChatGPT Codex

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
