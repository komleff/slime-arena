На основе анализа проекта U2 составлено техническое задание, описывающее логику и архитектуру ключевых модулей. Информация систематизирована из документации в папке `docs/`, исходного кода и конфигураций.

### **1. Физика полета**

**Общая модель:** Физика реализована для двухмерного пространства (плоскость X, Y). Основу составляет ньютоновская динамика: корабль обладает массой, инерцией и запасом импульса. Силы от двигателей прикладываются к центру массы.

**Ключевые принципы:**
*   **Расчет движения:** Изменение векторов скорости и позиции корабля рассчитывается на основе суммы всех приложенных сил (тяга, трение).
*   **Инерция и демпфирование:** Скорость не обнуляется мгновенно после прекращения тяги. В системе присутствует базовое демпфирование для имитации сопротивления среды.
*   **Угловое движение:** Вращение (рыскание, yaw) работает по аналогичным принципам с собственным моментом инерции и демпфированием.
*   **Ограничения (G-limits):** Система отслеживает и ограничивает линейные и угловые перегрузки, воздействующие на корабль, для соблюдения заданных тактико-технических характеристик.

**Основные компоненты:** Логика содержится в классах, ответственных за состояние корабля (`ShipState`, `FlightState`), и в системах, обновляющих физику (`PhysicsSystem`).

### **2. ТТХ кораблей и параметры Default Ship**

**Структура характеристик:** Технические характеристики каждого корабля определяются набором параметров, хранящихся в конфигурационных файлах. Эти параметры делятся на несколько категорий.

**Ключевые параметры:**
*   **Динамические:** Масса, момент инерции, базовое линейное и угловое демпфирование.
*   **Двигательные:** Максимальная тяга для основных маневровых двигателей (по осям вперед/назад, влево/вправо) и для поворотных двигателей (рыскание). Определяется время набора максимальной тяги (`throttleTime`).
*   **Ограничивающие:** Максимально допустимые линейная и угловая скорости, пределы по перегрузкам (`gLimitLinear`, `gLimitAngular`).
*   **Энергетические:** Емкость силовой установки, скорость ее перезарядки, потребление энергии системами.

**Корабль по умолчанию:** Конфигурация `default ship` (описанная в `shipTechSpecs`) служит эталонным шаблоном. Она определяет стандартные, сбалансированные значения всех перечисленных параметров, которые используются для инициализации корабля при отсутствии специфичной конфигурации.

### **3. Принцип управления кораблем**

**Ввод пользователя:** Управление строится на преобразовании дискретного или аналогового ввода пользователя (клавиши `WASD`, `Q/E`, джойстик, сенсорный ввод) в управляющие сигналы.

**Сигналы управления:** Пользовательский ввод формирует вектор желаемого направления тяги и сигнал поворота. Эти сигналы имеют интенсивность в диапазоне [-1, 1] для каждой оси.

**Преобразование в команды:** Модуль управления (`ControlSystem`, `InputHandler`) интерпретирует эти сигналы, учитывая активный режим полета (Coupled/Decoupled). На выходе формируются целевые значения для тяги каждого маневрового двигателя и вращающего момента, которые затем передаются в физическую модель для расчета результирующих сил.

### **4. Flight Assist и его режимы полета**

**Назначение:** Система `Flight Assist` (FA) — это набор алгоритмов, автоматически корректирующих управление для упрощения пилотирования.

**Режим Coupled (Связанный):**
*   **Логика:** Вектор тяги основных двигателей всегда привязан к текущей ориентации (носовой части) корабля. Нажатие `W` всегда дает ускорение вперед относительно корабля.
*   **Автоматизация:** Система активно гасит боковое и обратное скольжение (дрейф), автоматически задействуя боковые и обратные двигатели для возвращения вектора скорости в направлении носа корабля. Режим предназначен для привычного, "авиационного" управления.

**Режим Decoupled (Развязанный):**
*   **Логика:** Вектор тяги основных двигателей отвязан от ориентации. Нажатие `W` дает ускорение вперед относительно **глобальной системы координат или текущего направления полета**, а не носа корабля.
*   **Автоматизация:** Демпфирование дрейфа отключено или значительно ослаблено. Корабль сохраняет импульс и может свободно скользить в любом направлении независимо от своей ориентации. Требует от пилота ручного контроля вектора скорости.

**Переключение режимов:** Пилот может мгновенно переключаться между режимами `FA ON` (Coupled) и `FA OFF` (Decoupled) во время полета, что кардинально меняет поведение корабля.

### **5. Логика ассистента управления кораблем в мобильном режиме**

**Адаптация интерфейса:** Для мобильных устройств с сенсорным вводом виртуальные элементы управления (джойстики, кнопки) заменяют физическую клавиатуру. Ассистент оптимизирует их расположение и зону чувствительности.

**Интеллектуальная интерпретация ввода:** Алгоритм обрабатывает "сырые" касания, преобразуя их в плавные управляющие сигналы. Используется адаптивная фильтрация для компенсации неточности сенсорного ввода.

**Динамическая помощь:** В мобильном режиме ассистент может **автоматически усиливать** действие `Flight Assist`:
*   **Повышенное демпфирование:** Более агрессивное автоматическое гашение дрейфа в режиме Coupled для упрощения удержания курса.
*   **Ограничение вращения:** Мягкое ограничение скорости вращения для предотвращения потери ориентации из-за случайных касаний.
*   **Коррекция импульса:** Автоматическая небольшая коррекция вектора тяги при выполнении маневров для сохранения управляемости.

Логика направлена на сохранение глубины игрового процесса при одновременном снижении требований к точности ввода.

### **6. Алгоритм предиктивного сглаживания**

**Назначение:** Алгоритм предназначен для обеспечения плавной визуализации движения кораблей других игроков в сетевой игре, компенсируя задержки (`lag`) и потерю пакетов.

**Принцип работы (на стороне клиента):**
1.  **Клиентская экстраполяция:** Получив от сервера пакет с состоянием корабля (позиция, скорость, ускорение), клиент не просто "телепортирует" объект в новую точку. Вместо этого он сохраняет полученные данные и **прогнозирует** движение на небольшой промежуток времени вперед, основываясь на физической модели.
2.  **Коррекция расхождений:** Когда приходит следующий пакет от сервера, его состояние сравнивается с предсказанным. Если возникает расхождение, производится не резкая замена, а **плавная интерполяция** текущего (прогнозируемого) состояния к целевому (полученному от сервера) за фиксированное, короткое время.
3.  **Учет задержки:** Алгоритм учитывает текущий `ping` (время прохождения пакета) для корректировки временных меток поступающих данных и более точного предсказания.

**Результат:** Движение других кораблей воспринимается как плавное и непрерывное, даже при наличии сетевых помех. Резкие "скачки" и "телепортации" минимизируются. Логика реализуется в сетевом слое клиента (`ClientNetworkSystem`) и при обработке входящих сообщений о состоянии объектов.

Настоящее ТЗ описывает **архитектурную логику и требования** к модулям. Для получения точных формул, пороговых значений и деталей реализации необходимо обратиться к спецификациям в `docs/specs/`, исходному коду в `src/` и конфигурациям в `ships/`.