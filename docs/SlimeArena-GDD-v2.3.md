# Slime Arena — Game Design Document

**Версия:** 2.3  
**Автор:** Claude Opus  
**Дата:** декабрь 2025  
**Платформа:** мобильный браузер (основная), браузер на компьютере  
**Жанр:** казуальная многопользовательская арена  

---

## 0. Краткое резюме

### 0.1. Описание

Slime Arena — короткая (2–3 минуты) браузерная онлайн-арена. Милые слаймы собирают массу, растут и сражаются на навыке позиционирования: пасть наносит урон и «кусает» добычу, хвост уязвим. Прокачка только внутри матча (таланты), мета-прогресс — косметика и рейтинг.

### 0.2. Главный крючок (одна фраза)

«Съешь или будь съеден — но мило и за 2 минуты.»

### 0.3. Столпы проекта

1. **Матч не ставится на паузу.** Любые меню и выборы не лишают игрока контроля.
2. **Управление одним джойстиком.** Одна рука — движение с инерцией и заносом, вторая — умения.
3. **Бой без автоприцела.** Наведение и попадание — результат движения и тайминга.
4. **Против «снежного кома».** Сила растёт, но манёвренность падает по логарифму.
5. **Милота и антифрустрация.** Быстрый респаун, короткий матч, проигрыш не наказывает.

### 0.4. Целевой темп

**Сначала рост, потом стычки.** Первая минута — сбор и рост. Вторая минута — активные столкновения. Финал — интенсивная борьба за Hot Zone.

### 0.5. Баланс навыка и случайности

**Навык важнее.** Случайность влияет на спавн ресурсов и выбор талантов, но победа определяется позиционированием и таймингом.

### 0.6. Изменения версии 2.0

**Физика:**
- Увеличены лимиты `collisionImpulseCap` и `maxOrbSpeed` для поддержки больших масс (Босс, клановые бои)
- Скорость выше максимума гасится постепенно, а не мгновенно
- Честный отскок по закону сохранения импульса для всех столкновений

**Классы:**
- Страж переименован в Воина с +10% урона по слаймам

**Механики:**
- Глобальный кулдаун 100 мс между умениями с очередью нажатий
- Двойник теперь имеет 50% HP хозяина
- Масса убитого разлетается в пузыри (а не передаётся напрямую)
- Сундуки отлетают при столкновении, содержат % от массы игрока

**Пузыри:**
- Цвет и масса независимы (цвет — резерв для заданий)
- Добавлена плотность по цветам (золотой — самый плотный)

**Таланты:**
- Автовыбор через 30 сек (а не в конце матча)
- Исправлены некорректные таланты (Сила удара → Силовой приём, и др.)
- Яд разделён на Ядовитый плевок и Ядовитый укус

**Карта:**
- Прямоугольная арена с упругими стенками (отскоки от границ)

**Защита от злоупотреблений:**
- Лидеры не получают защиты при отключении
- Базовый щит 5 сек при респауне для всех

### 0.7. Изменения версии 2.1

**Новые механики (по анализу конкурентов):**
- **Последний вздох** — 0.5 сек на контратаку после смерти
- **Система Мятежник** — награда за убийство лидера
- **Адаптивный джойстик** — привязка под палец
- **Юмористические титулы** в конце матча

**Социальные функции:**
- Кланы и клановые сезоны (после MVP)

**Монетизация:**
- Ежедневный бесплатный сундук за вход

**Карта:**
- Биомы с разными свойствами (после MVP)

**Временные события:**
- Праздничные режимы (Хэллоуин, Новый год и др.)

### 0.8. Изменения версии 2.2

**Коллекционирование:**
- **Энциклопедия слаймов удалена** — заменена на Сезонный альбом
- **Сезонный альбом** — 50 карт за 4 недели, сброс каждый сезон
- **Сундук арены** — новый источник паков за накопленную массу
- **Слайм-клей** — сезонная валюта из дубликатов

**Технические заметки:**
- Добавлено Приложение D с требованиями для архитектуры
- Добавлены серверные сущности для системы паков и pity

### 0.9. Изменения версии 2.3

**Карта:**
- **Тороидальный мир удалён** — выбрана окончательно прямоугольная арена
- **Ghost-объекты удалены** — упрощение механики и восприятия
- **Упругие стенки** — все объекты отскакивают от границ карты
- **Углы карты** — тактически важные точки для опытных игроков

---

## 1. Концепция

### 1.1. Высокоуровневое описание

Игрок управляет слаймом на арене. На карте — питательные пузыри и сундуки. Собирая пузыри, слайм растёт. Большой слайм сильнее, но хуже поворачивает. Побеждает самый «толстый» к концу матча.

### 1.2. Целевая аудитория

**Основная:** мобильные казуальные игроки 12–35 лет, игра «урывками».  
**Вторичная:** игроки на компьютере, которым нравится соревноваться.

**Сложность управления:** низкий порог входа, высокий потолок мастерства. Новичок может играть без дрифта, опытный — использовать продвинутые техники.

### 1.3. Эмоциональное ядро

Игрок получает удовольствие от движения, отскоков и «кусачего» взаимодействия с пузырями. Проигрыш — не наказание: он краткий и понятный.

---

## 2. Управление и физика

### 2.1. Схема управления

- **Левая рука:** виртуальный джойстик — направление и сила тяги
- **Правая рука:** кнопки умений (по мере открытия) и быстрый выбор талантов

**Обработка касаний вне элементов управления:** игнорируются (не считаются вводом).

### 2.2. Адаптивный джойстик

**Режим привязки (по умолчанию):**
- Джойстик появляется в точке первого касания левой половины экрана
- Центр джойстика «следует» за пальцем, пока не достигнут максимальный радиус
- При отпускании джойстик исчезает
- Палец не заслоняет обзор, так как управление интуитивно

**Фиксированный режим (в настройках):**
- Статичный джойстик в левом нижнем углу
- Для игроков, предпочитающих постоянное положение

**Параметры через config:**

| Параметр | Назначение | Диапазон | По умолчанию |
|----------|------------|----------|--------------|
| `joystickMode` | Режим джойстика | adaptive / fixed | adaptive |
| `joystickRadius` | Радиус зоны | 60–140 px | 100 |
| `joystickDeadzone` | Мёртвая зона | 5–20% | 10% |
| `joystickSensitivity` | Множитель силы тяги | 0.5–2.0 | 1.0 |
| `joystickFollowSpeed` | Скорость следования центра | 0.5–1.0 | 0.8 |

**Настройки одинаковы для мобильных и десктопа.** На десктопе джойстик управляется мышью или WASD (переключается в настройках).

### 2.3. Модель движения

Джойстик задаёт желаемое направление. Слайм плавно разворачивается и движется туда. При резких поворотах слайм уходит в занос, потом «подтягивает нос» к направлению движения.

### 2.4. Дрифт-разворот

| Параметр | Значение | Через config |
|----------|----------|--------------|
| Пороговый угол | 120° | `driftThresholdAngle` |
| Длительность разворота | 0.3 сек | `driftDuration` |
| Потеря скорости | 50% | `driftSpeedLoss` |
| Задержка между срабатываниями | 0.5 сек | `driftCooldown` |

**Эффект:**
1. Резкое торможение до 50% текущей скорости
2. Быстрый разворот за 0.3 сек
3. Возобновление движения в новом направлении

**Можно ли дрифтить под действием умения:** да, дрифт и умения независимы.

### 2.5. Обратная связь

| Событие | Визуал | Звук | Вибрация |
|---------|--------|------|----------|
| Ускорение | Тело вытягивается | — | — |
| Торможение | Тело сплющивается | — | — |
| Столкновение | Упругий отскок, волна | «Бам» | Короткая |
| Укус пузыря | Уменьшение пузыря | «Чавк» | Короткая |
| Полное поглощение | Исчезновение + частицы | «Поп» | Средняя |
| Получение урона | Красная вспышка | «Ой» | Длинная |
| Перк готов | Свечение индикатора | «Динь» | Короткая |
| Последний вздох | Мигание слайма | «Эхо» | Пульсация |

### 2.6. Упругая физика

#### 2.6.1. Цель поведения

**Предсказуемость важнее правдоподобия.** Игрок должен понимать, куда полетит объект после столкновения.

#### 2.6.2. Параметры через config

| Параметр | Назначение | Диапазон | По умолчанию |
|----------|------------|----------|--------------|
| `environmentDrag` | Сопротивление среды | 0.01–0.10 | 0.03 |
| `collisionRestitution` | Доля сохраняемой энергии | 0.2–0.8 | 0.5 |
| `slimeLinearDamping` | Затухание слаймов | 0.01–0.05 | 0.02 |
| `orbLinearDamping` | Затухание пузырей | 0.03–0.15 | 0.08 |
| `collisionImpulseCap` | Макс. импульс | 5000–50000 | 10000 |
| `maxOrbSpeed` | Макс. скорость пузыря | 500–2000 | 1000 |
| `maxSlimeSpeed` | Макс. скорость слайма | 300–1000 | 500 |
| `speedDampingRate` | Скорость гашения превышения | 0.1–0.3 | 0.2 |

**Примечание:** `collisionImpulseCap` и `maxOrbSpeed` рассчитаны на большие массы (Босс ×5, клановые сражения в будущем). Импульс = масса × скорость, поэтому при массе 10000+ нужны высокие лимиты.

#### 2.6.3. Зависимость от массы

`collisionRestitution` **не зависит** от массы — одинаковый для всех столкновений. Различие в поведении достигается через разницу масс (лёгкие отлетают сильнее).

#### 2.6.4. Серия ударов

При серии ударов пузырь **затухает**, а не разгоняется. Каждое столкновение отнимает энергию.

### 2.7. Крайние случаи физики

| Ситуация | Поведение |
|----------|-----------|
| Столкновение 3+ объектов | Обрабатываются попарно в порядке обнаружения |
| Объект застрял | Принудительное раздвижение на следующем тике |
| Скорость выше максимума | Постепенное гашение: каждый тик −20% от превышения (`speedDampingRate`) |
| Масса слайма < 10 | Невозможно (минимум при респауне = 50) |
| Масса слайма > 1 000 000 | Формулы работают, тесты обязательны |

### 2.8. Настройки чувствительности

| Настройка | Описание | Диапазон |
|-----------|----------|----------|
| Чувствительность джойстика | Множитель силы тяги | 0.5–2.0 |
| Размер джойстика | Радиус в пикселях | 60–140 |
| Мёртвая зона | Процент от радиуса | 5–20% |

---

## 3. Слайм, бой и добыча

### 3.1. Зоны слайма

| Зона | Угол | Свойства |
|------|------|----------|
| Пасть | 120° (±60° от heading) | Наносит урон, кусает пузыри |
| Хвост | 120° (±60° от противоположного heading) | Получает ×1.5 урона |
| Бока | 2×60° | Нейтральные |

**Границы зон:** чёткие, без плавных переходов. При касании точно на границе — приоритет у зоны с большим уроном для атакующего.

### 3.2. Ближний бой

**Общий принцип:** при любом столкновении слаймов отрабатывается:
1. Проверка на возможный укус (контакт пастью)
2. Расчёт урона (если укус)
3. Отскок обоих слаймов по закону сохранения импульса с учётом `collisionRestitution`

| Ситуация | Результат |
|----------|-----------|
| Пасть → хвост | Полный урон + бонус ×1.5 по хвосту + отскок |
| Пасть → пасть | Оба получают урон + взаимный отскок |
| Пасть → бок | Обычный урон + отскок |
| Бок → бок | Только отскок, без урона |
| Хвост → хвост | Только отскок, без урона |

**Отскок:** всегда по закону сохранения импульса. Лёгкий слайм отлетает сильнее, тяжёлый — слабее. Никакого особого «продавливания» — физика честная.

**Неуязвимость после урона:** 0.2 сек (6 тиков). Предотвращает мгновенную смерть от серии попаданий.

**Дружественный огонь в командных режимах:** отключён. Союзники проходят сквозь друг друга.

### 3.3. Механика «Последний вздох»

При смерти слайм получает краткий шанс на контратаку:

| Параметр | Значение | Через config |
|----------|----------|--------------|
| Длительность | 0.5 сек | `lastBreathDuration` |
| Доступные действия | Только атака пастью | — |
| Урон | 50% от обычного | `lastBreathDamageMultiplier` |
| Скорость | 80% от обычной | `lastBreathSpeedMultiplier` |
| Визуал | Слайм мигает, полупрозрачный | — |
| Активация | Автоматическая при смерти от врага | — |

**Правила:**
- Если слайм успевает укусить врага — наносит урон
- Успешный укус даёт +10% к массе пузырей, выпадающих при смерти
- Убийца не получает дополнительного урона, если добьёт слайма в этой фазе
- Не работает при смерти от голода, отключения или окружения
- Слайм в фазе «Последний вздох» неуязвим

**Визуализация:**
- Слайм становится полупрозрачным (50% opacity)
- Быстрое мигание (5 Гц)
- Эффект «распадающихся частиц» вокруг
- Звуковой эффект «эхо»

**Цель:** снизить фрустрацию, дать шанс «отомстить», добавить драматизма финальным моментам боя.

### 3.4. Дальний бой

Направление выстрела совпадает с heading. Попадание — результат правильного наведения, без автоприцела.

**Можно ли активировать умение во время дрифта:** да.  
**Можно ли активировать умение во время отталкивания:** да.  
**Глобальный кулдаун между разными умениями:** да, 100 мс (см. раздел 4.3).

### 3.5. Питательные пузыри

#### 3.5.1. Типы пузырей

**Масса и цвет независимы.**

**По массе:**

| Размер | Масса | Частота |
|--------|-------|---------|
| Малый | 5–15 | 60% |
| Средний | 20–40 | 30% |
| Большой | 50–100 | 10% |

**По цвету (резерв для заданий):**

| Цвет | Плотность | Частота | Примечание |
|------|-----------|---------|------------|
| Зелёный | Низкая (0.8) | 40% | Базовый |
| Синий | Средняя (1.0) | 30% | — |
| Красный | Средняя (1.0) | 20% | — |
| Золотой | Высокая (1.5) | 10% | Редкий, самый питательный |

**Плотность** влияет на физику: плотный пузырь сложнее сдвинуть, он меньше отлетает при столкновении. Золотой пузырь — самый «тяжёлый» при той же массе.

**Цвет — резерв для заданий:** «Съешь 5 красных пузырей», «Собери 100 кг зелёных». Не влияет на питательность напрямую (питательность = масса).

Редких пузырей с особыми свойствами (ускорение, щит) **нет** в MVP. Возможно добавление позже.

#### 3.5.2. Поведение пузырей

| Свойство | Значение |
|----------|----------|
| Движение | По инерции от столкновений |
| Самостоятельное движение | Нет (только от физики) |
| Столкновения между пузырями | Да, обмениваются импульсом |
| Вращение | Нет (только линейное движение) |
| Плотность | Зависит от цвета |

#### 3.5.3. Спавн пузырей

| Параметр | Значение |
|----------|----------|
| Начальное количество | 100 на карту |
| Максимум на карте | 150 |
| Интервал респавна | 0.5 сек (если < максимума) |
| Распределение | Равномерное, исключая Hot Zones в финале |

#### 3.5.4. Механика укуса

**Событие укуса:** контакт пасти с пузырём. Отдельной кнопки нет.

**Кулдаун укуса:** 0.1 сек (3 тика). Нельзя «пулемётить» пузыри.

**Формула пожирательной способности:**
```
eatingPower = baseSwallowLimit × (1 + 0.05 × level) × classMultiplier
```

**Правило поглощения:**
- Если `eatingPower >= orbMass` → полное поглощение
- Иначе → откусывание доли `biteFraction`

**Откусывание:**
- Слайм получает: `orbMass × biteFraction`
- Остаток пузыря: `orbMass × (1 - biteFraction)`
- Остаток получает импульс отталкивания

**Можно ли «добить» остаток сразу:** да, после кулдауна укуса (0.1 сек).

**Критический укус:** нет. Поглощение детерминировано.

#### 3.5.5. Минимальный размер пузыря

| Параметр | Значение |
|----------|----------|
| `orbMinMass` | 3 |
| `orbMinRadius` | 5 пикселей |

Если после укуса `остаток < orbMinMass` → полное поглощение (остаток не создаётся).

#### 3.5.6. Физика при укусе

При контакте слайма с пузырём происходит **взаимный отскок** по закону сохранения импульса:

**Пузырь:**
- Направление: от центра слайма к центру пузыря
- Величина: зависит от массы слайма и скорости столкновения
- Ограничение: `collisionImpulseCap`

**Слайм:**
- Тоже получает импульс отталкивания
- Если слайм маленький, а пузырь большой — слайм отлетит сильнее
- Импульс сохраняется относительно исходного движения (векторное сложение)

**Пример:** слайм массой 100 врезается в золотой пузырь массой 80 с высокой плотностью — оба отлетают примерно одинаково.

#### 3.5.7. Визуализация взаимодействия с пузырём

| Событие | Описание | Визуал | Звук |
|---------|----------|--------|------|
| Полное поглощение | Пасть + пузырь по силам | Исчезновение + частицы | «Поп» |
| Частичный укус | Пасть + пузырь больше лимита | Уменьшение + отлёт | «Чавк» |
| Столкновение без укуса | Бок/хвост + пузырь | Оба отлетают | «Буп» (ниже тоном) |

---

## 4. Умения

### 4.1. Ячейки умений

| Ячейка | Открытие | Описание |
|--------|----------|----------|
| `slot1` | Сразу | Классовое умение |
| `slot2` | Уровень 3 | Выбор 1 из 2 |
| `slot3` | Уровень 5 | Выбор 1 из 2 |

### 4.2. Набор умений

| Умение | Назначение | Стоимость | Восстановление | MVP |
|--------|------------|-----------|----------------|-----|
| Рывок | Догнать/уйти | 3% | 5 сек | Да |
| Выброс | Дальняя атака | 2% | 3 сек | Да |
| Щит | Пережить разворот | 4% | 8 сек | Да |
| Притяжение | Облегчить сбор | 1.5% | 6 сек | Да |
| Приманка | Сбить преследование | 2% | 4 сек | Нет |
| Деление | Временный двойник | 25% | 15 сек | Нет |
| Шип | Конусная атака | 2.5% | 4 сек | Нет |

**Умения для MVP:** Рывок, Выброс, Щит, Притяжение.

### 4.3. Детали умений

**Глобальный кулдаун (GCD):** 100 мс (3 тика) между любыми умениями. Предотвращает спам из трёх умений одновременно.

**Очередь нажатий:** если игрок нажал умение во время GCD, оно ставится в очередь и активируется автоматически после окончания GCD. Максимум 1 умение в очереди.

**Отмена умения:** нет. Все умения мгновенные.

**Стоимость:** только `massPercent`. Отдельного ресурса нет.

**Рывок:**
- Дистанция: 150 единиц
- Длительность: 0.2 сек
- Во время рывка можно есть пузыри
- Столкновение с врагом наносит урон и прерывает рывок

**Выброс:**
- Дальность: 300 единиц
- Скорость снаряда: 400 единиц/сек
- Урон: 100% от базового урона слайма
- Снаряд проходит сквозь пузыри, но не сквозь слаймов

**Щит:**
- Длительность: 2 сек
- Поглощает весь входящий урон
- Можно есть пузыри под щитом
- Атака снимает щит досрочно

**Притяжение:**
- Радиус: 150 единиц
- Длительность: 1.5 сек
- Притягивает только пузыри, не слаймов
- Сила притяжения: 50 единиц/сек к центру слайма

**Двойник (Деление):**
- Цель: ближайший враг в радиусе 200 единиц
- Если врагов нет: двойник следует за игроком
- HP двойника: 50% от HP хозяина
- Живёт до смерти или 10 сек (что раньше)
- Наносит 50% урона владельца
- Масса двойника: 25% от массы владельца (расходуется при активации)

### 4.4. Будущее развитие (после MVP)

**Четвёртое умение — Ульта:**
- Открывается на уровне 7
- Требует энергии ульты (копится от урона/убийств)
- Мощный эффект с длинным кулдауном (30 сек)
- Примеры: Взрывная волна, Временная неуязвимость, Массовое притяжение

### 4.5. Взаимодействия умений

| Комбинация | Поведение |
|------------|-----------|
| Щит + Дрифт | Работают независимо |
| Щит + Укус пузыря | Можно есть под щитом |
| Рывок + Укус | Можно есть во время рывка |
| Рывок + Столкновение | Урон наносится, рывок прерывается |
| Притяжение + Рывок | Можно комбинировать |
| Выброс + Дрифт | Выстрел в направлении до дрифта |

---

## 5. Классы

### 5.1. Базовые характеристики

| Класс | Пассив | Стартовое умение | Роль | Сложность |
|-------|--------|------------------|------|-----------|
| Охотник | +15% скорость, −10% HP | Рывок | Мобильная агрессия | Средняя |
| Воин | +15% HP, +10% урон по слаймам, −10% скорость | Щит | Танк-боец | Новичок |
| Собиратель | +25% радиус сбора, +15% eatingPower | Притяжение | Фарм и поддержка | Новичок |

**Количество классов на запуск:** 3.

**Смена класса после начала матча:** нет.

**Уникальные умения:** только стартовое. Остальные умения общие для всех классов.

### 5.2. Различия классов

**Охотник:**
- Быстрый, но хрупкий
- Лучше в погонях и побегах
- Хуже в лобовых столкновениях
- Рывок позволяет быстро сокращать дистанцию
- Оптимален для охоты на Мятежника

**Воин:**
- Толстый и бьёт сильно
- Медленнее, но опаснее в бою
- Щит позволяет выживать в замесах
- Больше откусывает от противников (урон = масса)
- Часто становится Мятежником из-за высокой живучести

**Собиратель:**
- Лучший фармер
- Быстрее растёт по массе
- Слабее в прямом бою
- Притяжение эффективно в зонах с высокой плотностью пузырей

### 5.3. Пожирательная способность

| Класс | swallowLimit | Бонус/уровень | biteFraction |
|-------|--------------|---------------|--------------|
| Охотник | 50 | +5% | 0.3 |
| Воин | 45 | +4% | 0.35 |
| Собиратель | 70 | +8% | 0.5 |

### 5.4. Могут ли классы менять роль перками

**Да, частично.** Охотник может взять перки на выживание. Собиратель может взять перки на урон. Но базовые пассивы остаются.

---

## 6. Прогресс внутри матча

### 6.1. Масса и уровни

| Масса | Уровень | Что открывается |
|-------|---------|-----------------|
| 0–100 | 1 | Старт, `slot1` |
| 100–250 | 2 | 1 талант |
| 250–500 | 3 | `slot2` |
| 500–1000 | 4 | 2 талант |
| 1000–2000 | 5 | `slot3` |
| 2000+ | 6+ | Талант при удвоении |

**Минимальная масса:** 50 (при респауне).  
**Максимальная масса:** не ограничена (формулы работают).

### 6.2. Источники и потери массы

**Источники:**
- Питательные пузыри
- Сундуки (процент от текущей массы, см. раздел 8)
- 10% от нанесённого урона (мгновенно)
- Пузыри от убитого врага (см. ниже)

**При смерти врага:**
- 50% его массы теряется навсегда
- 30% разлетается в виде 3–5 пузырей вокруг места смерти
- 20% остаётся у убитого при респауне (минимум 50)

**Пузыри от смерти:**
- Разлетаются радиально от точки смерти
- Цвет случайный
- Масса распределяется равномерно между пузырями
- Любой игрок может их собрать (включая убийцу и союзников убитого)

**Бонус от «Последний вздох»:**
- Если слайм успешно укусил врага в фазе «Последний вздох» — выпадает 40% массы (вместо 30%)

**Потери:**
- Стоимость умений
- 50% при смерти (30% в пузыри + 20% исчезает)
- Эффект голода вне Hot Zone

### 6.3. Формулы баланса

| Параметр | Формула |
|----------|---------|
| HP | 50 + 50 × ln(1 + mass / 100) |
| Урон | 10 + 10 × ln(1 + mass / 100) |
| Скорость | 1 / (1 + ln(1 + mass / 500)) |
| Радиус | 10 × √(1 + ln(1 + mass / 50)) |
| Поворот | 180° / (1 + ln(1 + mass / 200)) |

### 6.4. Границы параметров

| Параметр | Минимум | Максимум |
|----------|---------|----------|
| Скорость | 10% от базовой | 100% от базовой |
| Поворот | 20°/сек | 180°/сек |
| HP | 50 | Не ограничено |
| Урон | 10 | Не ограничено |

---

## 7. Таланты без паузы

### 7.1. Механика очереди

- При повышении уровня талант добавляется в очередь
- Максимум в очереди: **3**
- **Автовыбор:** если игрок не выбрал талант за 30 сек, автоматически выбирается лучший по приоритету класса (или случайный среди равных)

**Приоритет автовыбора по классам:**
- Охотник: Манёвренность > Урон > остальное
- Воин: Живучесть > Урон > остальное
- Собиратель: Сбор > Живучесть > остальное

### 7.2. Быстрый выбор

**Как открывается:** нажатие на индикатор «+N» возле кнопок умений.

**Время на выбор:** не ограничено (пока игрок в режиме выбора).

**Описания талантов:** краткие (2–3 слова), без развёрнутого текста.

**При бездействии:** режим выбора остаётся активным, пока игрок не выберет или не отменит.

**Конфликт с умениями:** при входе в режим выбора кнопки умений заменяются на таланты. Если игрок хотел нажать умение — он должен сначала отменить выбор (свайп вниз).

### 7.3. Защита от ошибок

- При получении урона режим выбора закрывается автоматически
- Талант остаётся в очереди
- Задержка перед повторным открытием: 0.5 сек

### 7.4. Редкость талантов

| Редкость | Вероятность | Количество в пуле |
|----------|-------------|-------------------|
| Обычный | 60% | 15 |
| Редкий | 30% | 10 |
| Эпический | 10% | 5 |

**Всего талантов в пуле:** 30.

### 7.5. Пул талантов

#### Обычные (15 штук)

| Категория | Талант | Эффект |
|-----------|--------|--------|
| Живучесть | Толстая кожа | +10% HP |
| Живучесть | Регенерация | +1% массы/5 сек |
| Живучесть | Упорство | −10% потерь при смерти |
| Манёвренность | Проворность | +10% скорость |
| Манёвренность | Лёгкость | +10% скорость поворота |
| Манёвренность | Экономия | −20% стоимость рывка |
| Урон | Острые зубы | +15% урон укусом |
| Урон | Силовой приём | Столкновение боком/хвостом наносит 5 урона |
| Урон | Тяжесть | +20% отталкивание врагов |
| Сбор | Магнетизм | +20% радиус притяжения |
| Сбор | Обжора | +10% eatingPower |
| Сбор | Жадность | +20% массы от пузырей |
| Сбор | Предчувствие | Видеть место появления сундука за 5 сек |
| Универсал | Ускорение КД | −10% восстановление умений |
| Универсал | Экономия массы | −10% стоимость умений |

#### Редкие (10 штук)

| Категория | Талант | Эффект |
|-----------|--------|--------|
| Живучесть | Большой щит | +2 сек к щиту при респауне |
| Живучесть | Стойкость | +25% HP |
| Манёвренность | Мастер дрифта | −30% потеря скорости при дрифте |
| Манёвренность | Скользкий | +20% скорость, +15% поворот |
| Урон | Ядовитый плевок | Выброс отравляет на 3 сек (−2% массы/сек) |
| Урон | Ядовитый укус | Укус отравляет на 3 сек (−2% массы/сек) |
| Урон | Пробивание | Выброс проходит сквозь первую цель |
| Сбор | Вакуум | Автосбор пузырей в радиусе 50 |
| Сбор | Большой рот | +30% eatingPower |
| Универсал | Адреналин | +20% скорость при HP < 30% |

#### Эпические (5 штук)

| Талант | Эффект |
|--------|--------|
| Поглощение | Убийство восстанавливает 50% HP |
| Последний шанс | Один раз за матч: вместо смерти остаётся 1 HP + щит 3 сек |
| Магнит | Постоянное притяжение пузырей в радиусе 100 |
| Вечный двойник | Двойник живёт до смерти (не по таймеру) |
| Мученик | При своей смерти — урон 50 по области вокруг (радиус 100) |

### 7.6. Распределение по категориям

| Категория | Доля в пуле |
|-----------|-------------|
| Живучесть | 20% |
| Манёвренность | 20% |
| Урон | 20% |
| Сбор | 25% |
| Универсал | 15% |

### 7.7. Reroll

**В MVP:** нет.

**После MVP:** токен на Reroll за просмотр рекламы **до начала матча** (в лобби). Токен действует 1 матч, позволяет перебросить 1 набор талантов.

### 7.8. Защита от плохих билдов

При выборе всегда предлагается минимум 1 талант из категории, соответствующей классу:
- Охотник: гарантирован 1 талант Урон/Манёвренность
- Воин: гарантирован 1 талант Живучесть
- Собиратель: гарантирован 1 талант Сбор

---

## 8. Сундуки

### 8.1. Параметры

| Параметр | Значение |
|----------|----------|
| Максимум на карте | 3 |
| Интервал спавна | 20 сек |
| Открытие | Касание пастью (мгновенно) |

### 8.2. Физика сундуков

Сундук — **физический объект**:
- Отлетает при столкновении с боком/хвостом слайма
- Отлетает при столкновении с пузырём
- Масса сундука: 200 (тяжелее большинства пузырей)
- Это добавляет хаоса и веселья: можно «выбить» сундук у противника

### 8.3. Содержимое

| Тип | Содержимое | Частота |
|-----|------------|---------|
| Бронзовый | +10% массы слайма ИЛИ обычный талант | 70% |
| Серебряный | +20% массы слайма ИЛИ редкий талант | 25% |
| Золотой | +30% массы слайма ИЛИ эпический талант | 5% (макс 1 за матч) |

**Масса от сундука:** процент от текущей массы слайма, а не фиксированное число. Это делает сундуки ценными на любой стадии матча.

**Вероятность таланта vs массы:** 30% талант, 70% масса.

### 8.4. Перехват сундука

Сундук достаётся тому, кто первым коснулся пастью. «Перехват открытия» невозможен, но можно выбить сундук у противника столкновением.

### 8.5. Качество талантов из сундуков

Сундук может дать талант выше «текущего уровня качества» игрока. Это один из способов получить эпический талант на раннем уровне.

### 8.6. Метки на сундуки

Метка (индикатор за экраном) появляется **у всех игроков** одновременно при спавне сундука.

---

## 9. Карта, фазы и финал

### 9.1. Границы карты и упругие стенки

**Геометрия:** прямоугольная карта с жёсткими границами на всех сторонах.

**Отскок от стен:** все объекты (слаймы, пузыри, сундуки) упруго отскакивают от стен карты.

**Механика отскока:**
- Отскок подчиняется закону сохранения импульса (как столкновение с массивным объектом)
- `collisionRestitution` применяется одинаково для всех столкновений со стеной
- Компонента скорости, перпендикулярная стене, инвертируется и масштабируется на `restitution`
- Компонента скорости вдоль стены сохраняется (с учётом `environmentDrag`)

**Тактика:**
- Углы карты становятся тактически важными точками (возможны экстренные манёвры)
- Опытные игроки используют отскоки от стен для ускорения или резкого разворота
- На дальних берегах карты меньше конкуренции за ресурсы

**Визуализация границ:**
- Стены видны как полупрозрачные барьеры (слегка светящиеся)
- На экране за границей изображения видна граница карты
- Звук тихого удара при столкновении со стеной

### 9.2. Размер карты

| Параметр | Значение |
|----------|----------|
| Размер | 2000 × 2000 единиц |
| Видимая область | 400 × 300 единиц (масштабируется с массой) |
| Масштаб камеры | 1.0 + 0.1 × ln(1 + mass / 200) |

### 9.3. Биомы (после MVP)

Карта делится на зоны с разными свойствами:

| Биом | Эффект | Визуал | Размер |
|------|--------|--------|--------|
| Обычный | Нет модификаторов | Зелёная трава | 40% карты |
| Болото | −20% скорость всех | Тёмно-зелёное, пузыри | 15% |
| Пустыня | +15% скорость, −10% поворот | Жёлтый песок | 15% |
| Лёд | −30% трение (дольше скольжение) | Голубой, блики | 15% |
| Вулкан | Периодический урон 5/сек | Красные трещины | 15% |

**Правила:**
- Биомы фиксированы на карте (не меняются в течение матча)
- Hot Zone всегда в обычном биоме (центр)
- Границы чёткие, визуально различимые
- Переход между биомами мгновенный

**Влияние на стратегию:**
- Охотники предпочитают пустыню (скорость важнее поворота)
- Собиратели избегают болота (замедление мешает сбору)
- Вулкан — зона риска с редкими золотыми пузырями (повышенный спавн)

### 9.4. Фазы матча

| Фаза | Время | Особенности |
|------|-------|-------------|
| Спавн | 0:00–0:15 | Щит 5 сек, знакомство с окружением |
| Сбор | 0:15–1:00 | Много пузырей, редкие стычки |
| Охота | 1:00–1:30 | PvP активнее, сундуков больше |
| Хаос | 1:30–2:00 | Голод начинается, Hot Zones появляются |
| Финал | 2:00–2:30 | Максимальная концентрация, сильный голод |

### 9.5. Горячие зоны

| Фаза | Количество | Размер | Множитель спавна пузырей |
|------|------------|--------|--------------------------|
| Хаос | 2 | Средние (радиус 200) | ×3 |
| Финал | 1 | Большая (радиус 400, центр) | ×5 |

**Движение зон:** нет. Позиции фиксированы (центр карты для финала).

**Визуальное отличие:** яркость и пульсация границы. Финальная зона — золотая.

### 9.6. Система «Мятежник»

Самый крупный слайм на карте получает статус **Мятежник**:

| Параметр | Значение | Через config |
|----------|----------|--------------|
| Порог активации | Масса > 150% от средней | `rebelMassThreshold` |
| Интервал обновления | 5 сек | `rebelUpdateInterval` |
| Визуал | Красная корона над слаймом | — |
| Метка на HUD | Постоянная стрелка для всех | — |
| Награда за убийство | +50% массы от обычного | `rebelKillMassBonus` |
| Бафф убийце | +10% скорость на 10 сек | `rebelKillSpeedBuff` |
| Пузыри при смерти | 40% (вместо 30%) | `rebelDeathOrbPercent` |

**Правила:**
- Статус обновляется каждые 5 сек
- Мятежник видит, что он помечен (иконка на HUD + текст «Вы — Мятежник!»)
- При смерти Мятежника всем игрокам показывается оповещение «[Ник] убил Мятежника!»
- Убийца получает титул «Убийца гигантов» в конце матча

**Можно ли быть Мятежником несколько раз:** да, статус пересчитывается динамически.

**Что если несколько слаймов равны:** Мятежником становится тот, кто достиг массы раньше.

**Цель:** создать динамичный финал, предотвратить доминирование одного игрока, поощрить охоту на лидера.

### 9.7. Эффект «голод»

| Параметр | Значение | Через config |
|----------|----------|--------------|
| Что отнимает | Массу (не HP) | — |
| Базовая сила | 1% массы каждые 3 сек | `hungerBaseDrain` |
| Нарастание | +0.5% за каждые 30 сек вне зоны | `hungerScaling` |
| Начало | Фаза Хаос (1:30) | `hungerStartTime` |
| Максимум | 5% массы каждые 3 сек | `hungerMaxDrain` |

**Можно ли пересидеть финал вне зоны:** теоретически да, если масса очень большая. Но потеря массы сделает это невыгодным.

**Голод не убивает:** масса не опускается ниже 50 от голода.

### 9.8. Предупреждения и визуализация

| Событие | Предупреждение | Время до события |
|---------|----------------|------------------|
| Переход к Охоте | «Охота началась!» | 0 сек |
| Переход к Хаосу | «Зоны появляются через 10 сек» | 10 сек |
| Переход к Финалу | «Финал через 10 сек» | 10 сек |
| Вне зоны | Иконка «голод» + визуальные эффекты | — |
| Новый Мятежник | «[Ник] стал Мятежником!» | — |
| Мятежник убит | «[Ник] убил Мятежника!» | — |

**Визуализация опасной зоны:**
- На миникарте/HUD показан центр Hot Zone
- Вокруг центра — пульсирующий круг безопасной зоны
- За пределами круга — тонировка в красный цвет
- Чем дальше от центра — тем сильнее тонировка

**Визуализация голода на слайме:**
- Слайм тускнеет (−30% яркости)
- Появляются капли «пота»
- Периодическое «сжатие» (как будто слабеет)
- Звук «урчания живота» каждые 3 сек

---

## 10. Режимы игры

### 10.1. Все против всех (FFA)

- Игроков: 10–20
- Условие победы: максимальная масса к концу матча
- При ничьей (одинаковая масса): побеждает тот, кто достиг массы раньше

**Входит в MVP:** да.

### 10.2. Командный бой

- 2v2 или 3v3
- Условие победы: максимальная суммарная масса команды
- Распределение наград: поровну всем членам команды

**Возрождение союзников:** автоматическое, как в FFA. Специальной механики нет.

**Командные умения/баффы:** командные таланты в пуле (лечение касанием, общий щит).

**Дружественный огонь:** отключён. Союзники проходят сквозь друг друга.

**Система Мятежник:** применяется к командам (команда-мятежник, если суммарная масса > 150% от средней команды).

**Входит в MVP:** нет. Добавляется в Альфе.

### 10.3. Охота на босса (PvPvE)

**Выбор босса:** случайно из добровольцев. Если добровольцев нет — случайно из всех.

**Характеристики босса:**

| Параметр | Модификатор |
|----------|-------------|
| Стартовая масса | ×5 |
| HP | ×3 (сверх формулы) |
| Урон | ×1.5 |
| Скорость | −30% |
| Поворот | −20% |

**Уникальное умение босса — Шоковая волна:**
- Урон: 30 по всем в радиусе 200
- Отталкивание: 150 единиц
- Кулдаун: 10 сек
- Стоимость: 5% массы

**Награды:**
- Босс выжил: босс получает ×3 рейтинга
- Босс убит: убийца получает ×2 рейтинга, все участники получают бонус
- Урон боссу: +20% массы от нанесённого урона (всем, кто нанёс урон)

**Защита от игнорирования босса:** босс регенерирует +2% HP/сек, если не получал урон 10 сек.

**Входит в MVP:** нет. Добавляется в Бете.

### 10.4. Временные режимы (после MVP)

Праздничные и событийные режимы:

| Событие | Режим | Особенности | Период |
|---------|-------|-------------|--------|
| Хэллоуин | Тыквенный ужас | Босс-тыква, ночная карта, призрачные пузыри | Октябрь |
| Новый год | Ледяная арена | Весь мир — лёд, снежки вместо выброса | Декабрь–Январь |
| День влюблённых | Парный бой | Случайные пары, общее HP | Февраль |
| Пасха | Охота за яйцами | Особые пузыри-яйца с редкими наградами | Апрель |
| Лето | Пляжная вечеринка | Водная карта, замедление на песке | Июнь–Август |

**Частота:** 1 событие в месяц, длительность 1 неделя.

**Награды:** уникальные сезонные скины, недоступные после события.

**Входит в MVP:** нет. Первое событие — Хэллоуин после запуска.

---

## 11. Смерть и антифрустрация

### 11.1. Потери при смерти

| Параметр | Значение |
|----------|----------|
| Потеря массы | 50% текущей |
| Выпадает на землю | 30% (в виде 3–5 пузырей) |
| Исчезает навсегда | 20% |
| Кто может подобрать | Все игроки |

### 11.2. Респаун

| Параметр | Значение |
|----------|----------|
| Задержка | 2 сек |
| Позиция | Случайная, минимум 200 единиц от врагов |
| Щит | 5 сек неуязвимости (всем, базовый) |
| Атака под щитом | Снимает щит |
| Минимальная масса | 50 |

**Базовый щит при респауне (5 сек)** — защита от кемперов. Даётся всем игрокам независимо от талантов. Талант «Большой щит» добавляет +2 сек сверху.

### 11.3. Антифрустрация

| Механика | Описание |
|----------|----------|
| Быстрый респаун | 2 сек задержки, мгновенное возвращение |
| Последний вздох | 0.5 сек на контратаку после смерти |
| Минимальная масса | Всегда не меньше 50 |
| Короткие матчи | 2–3 минуты, проигрыш не критичен |
| Юмористические титулы | Даже проигравшие получают забавный титул |
| Система Мятежник | Слабые игроки могут охотиться на сильных |

---

## 12. Прогресс между матчами

### 12.1. Что сохраняется

- Рейтинг
- Косметика
- Статистика (матчи, победы, убийства, макс. масса)
- Валюта (капли)
- Достижения
- Прогресс сезонного альбома (сбрасывается каждый сезон)
- Прогресс сезонного пропуска

### 12.2. Рейтинговая система

**Формула:**
```
ΔRating = K × (ActualScore - ExpectedScore)
```

Где:
- K = 32 (для новых игроков), 24 (для опытных)
- ActualScore = место в матче (1.0 для 1 места, 0.0 для последнего)
- ExpectedScore = вероятность на основе текущего рейтинга

**Лиги:**

| Лига | Рейтинг | Иконка |
|------|---------|--------|
| Капля | 0–999 | 💧 |
| Слизень | 1000–1499 | 🐌 |
| Слайм | 1500–1999 | 🟢 |
| Гигант | 2000–2499 | 🟡 |
| Титан | 2500–2999 | 🟠 |
| Легенда | 3000+ | 👑 |

**Сезоны:**
- Длительность: 4 недели
- Сброс: мягкий (−20% от рейтинга выше 1500)
- Награды по итогам: рамка профиля + капли

### 12.3. Сезонный альбом (после MVP)

Система сезонного коллекционирования для долгосрочного удержания. Вдохновлена механикой Royal Collection из Royal Match.

**Входит в MVP:** нет. Добавляется после MVP.

#### 12.3.1. Концепция

**Что такое «карта»:** коллекционный арт-стикер (не экипировка, не юнит). Тематически связан с сезоном: биомы, мятежник, классы, эмоции, праздники.

**Ценность:** закрытие коллекции + демонстрация статуса (бейдж в профиле).

**Синхронизация:** альбом сбрасывается вместе с сезоном рейтинга, кланов и пропуска (4 недели).

#### 12.3.2. Структура коллекции

| Параметр | Значение |
|----------|----------|
| Карт за сезон | 50 |
| Страниц | 5 (по 10 карт) |
| Длительность сезона | 28 дней |
| Тема | Меняется каждый сезон |

**Редкости:**

| Редкость | Количество | Рамка | Шанс в Bronze-паке |
|----------|------------|-------|-------------------|
| Common | 30 | Серая | 75% |
| Rare | 12 | Синяя | 20% |
| Epic | 6 | Фиолетовая | 4.5% |
| Legendary | 2 | Золотая, анимированная | 0.5% |

**Страницы (пример тем для сезона «Болотные твари»):**
1. Лесные слаймы (10 карт)
2. Болотные обитатели (10 карт)
3. Охотники арены (10 карт)
4. Мятежники и титаны (10 карт)
5. Легенды сезона (10 карт)

#### 12.3.3. Типы паков

| Пак | Карт | Гарантия | Цвет |
|-----|------|----------|------|
| Bronze | 3 | — | Бронзовый |
| Silver | 4 | 1 Rare+ | Серебряный |
| Gold | 5 | 1 Epic+ | Золотой |
| Rainbow | 6 | 1 Legendary | Радужный |

**Вероятности по слоту (Bronze-пак):**

| Редкость | Слот 1 | Слот 2 | Слот 3 |
|----------|--------|--------|--------|
| Common | 75% | 75% | 75% |
| Rare | 20% | 20% | 20% |
| Epic | 4.5% | 4.5% | 4.5% |
| Legendary | 0.5% | 0.5% | 0.5% |

**Silver-пак:** слот 1 гарантированно Rare+, остальные как Bronze.

**Gold-пак:** слот 1 гарантированно Epic+, слот 2 гарантированно Rare+, остальные как Bronze.

**Rainbow-пак:** слот 1 гарантированно Legendary, слот 2-3 гарантированно Epic+, остальные Rare+.

#### 12.3.4. Источники получения

**Ежедневные:**

| Источник | Награда | Условие |
|----------|---------|---------|
| Ежедневный сундук | +1 Bronze-пак | Вход в игру |
| Rewarded-ad | ×2 Bronze-пак | Просмотр рекламы после сундука |
| 2/3 ежедневных заданий | 1 Bronze-пак | Выполнение |
| 3/3 ежедневных заданий | +1 Bronze-пак | Выполнение всех |

**Еженедельные:**

| Источник | Награда | Условие |
|----------|---------|---------|
| Еженедельное задание | 1 Silver-пак | За каждое выполненное |
| Все 3 еженедельных | +1 Gold-пак | Выполнение всех |

**Сундук арены (новая механика):**

Прогресс по накопленной массе за матчи. Полоска на экране результатов.

| Лига | Масса для Bronze-пака | Макс. паков/день |
|------|----------------------|------------------|
| Капля | 500 кг | 3 |
| Слизень | 750 кг | 3 |
| Слайм | 1000 кг | 4 |
| Гигант | 1500 кг | 4 |
| Титан | 2000 кг | 5 |
| Легенда | 2500 кг | 5 |

**Правила сундука арены:**
- Прогресс накапливается между матчами
- Считается вся масса за матч (не только финальная)
- При достижении порога — автоматическое получение пака
- Счётчик сбрасывается после получения пака
- Прогресс к следующему паку сохраняется при выходе

**Сезонный пропуск:**

| Ветка | Награды альбома |
|-------|-----------------|
| Free | 8 Bronze + 4 Silver |
| Premium | +6 Silver + 2 Gold + 1 Rainbow |

**Распределение по уровням пропуска (30 уровней):**
- Free: Bronze на уровнях 2, 5, 8, 11, 14, 17, 20, 23; Silver на 10, 15, 20, 25
- Premium: Silver на 3, 6, 9, 12, 18, 21; Gold на 24, 27; Rainbow на 30

**Кланы:**

| Источник | Награда |
|----------|---------|
| Клановая лига Золото | 1 Gold-пак всем участникам |
| Клановая лига Платина | 2 Gold-пака всем участникам |
| Клановая лига Алмаз | 3 Gold-пака + 1 Rainbow всем участникам |

**Сезонные события:**

| Источник | Награда |
|----------|---------|
| Праздничный режим (1 неделя) | 2-3 эксклюзивные карты (Epic/Legendary) |
| Финальное событие (последние 3 дня) | +50% шанс Legendary в паках |

#### 12.3.5. Pity-система (защита от неудачи)

| Гарантия | Условие | Сброс |
|----------|---------|-------|
| Новая карта | После 4 паков без новой карты | При получении новой |
| Epic | После 20 паков без Epic | При получении Epic |
| Legendary | После 50 паков без Legendary | При получении Legendary |

**Правила:**
- Счётчики pity — общие для всех типов паков
- Гарантированный предмет заменяет один из слотов пака
- Rainbow-пак сбрасывает счётчик Legendary

**Параметры через config:**

| Параметр | Назначение | Диапазон | По умолчанию |
|----------|------------|----------|--------------|
| `pityNewCardThreshold` | Паков до гарантии новой | 3-6 | 4 |
| `pityEpicThreshold` | Паков до гарантии Epic | 15-30 | 20 |
| `pityLegendaryThreshold` | Паков до гарантии Legendary | 40-70 | 50 |

#### 12.3.6. Дубликаты и Слайм-клей

**Конвертация:**

| Редкость дубликата | Слайм-клей |
|--------------------|------------|
| Common | 1 |
| Rare | 5 |
| Epic | 20 |
| Legendary | 100 |

**Обмен клея на паки:**

| Пак | Стоимость | Особенность |
|-----|-----------|-------------|
| Bronze | 50 клея | Стандартный |
| Silver | 150 клея | Стандартный |
| Gold | 400 клея | Гарантия новой карты |

**Конец сезона:**
- Неиспользованный клей → капли (курс 10:1)
- Незакрытые карты сгорают
- Счётчики pity сбрасываются

**Сезонность валюты:**
- Слайм-клей не переносится между сезонами
- Это предотвращает инфляцию и создаёт срочность

#### 12.3.7. Награды

**За страницы (5 страниц):**

| Прогресс | Награда |
|----------|---------|
| 1 страница (10 карт) | 50 капель |
| 2 страницы (20 карт) | Юмористический титул сезона |
| 3 страницы (30 карт) | 100 капель + сезонная рамка |
| 4 страницы (40 карт) | 200 капель + сезонный след |
| 5 страниц (50 карт) | **Полная награда** (см. ниже) |

**Полная награда за 100%:**
- Сезонный бейдж профиля (уникальный каждый сезон)
- Легендарный скин (эксклюзивный, не повторяется)
- 500 капель
- Титул «Коллекционер [название сезона]»

**Бейдж:**
- Отображается в профиле и в таблицах результатов
- Накапливается: игрок может показать все бейджи прошлых сезонов
- Визуально отличается каждый сезон (тематика)

#### 12.3.8. Интерфейс альбома

**Экран коллекции:**
- Кнопка «Альбом» в главном меню (рядом с профилем)
- 5 вкладок-страниц с сеткой 2×5 карт
- Пустые слоты — серый силуэт с «?»
- Собранные — полноцветная карта с рамкой редкости

**Информация на экране:**
- Прогресс: «32/50 карт»
- Таймер: «До конца сезона: 5д 12ч»
- Слайм-клей: иконка + количество
- Кнопка «Обменять клей»

**Открытие пака:**
- Анимация распаковки (карты вылетают по одной)
- Новые карты: подсветка + надпись «NEW»
- Дубликаты: надпись «+X клея»
- Legendary: особая анимация с эффектами

**Просмотр карты:**
- Увеличенное изображение
- Название и редкость
- Флейвор-текст (юмористический)
- Статус: «Собрано» / «Не найдено»

#### 12.3.9. Монетизация (без Pay-to-Win)

**Магазин (за капли или реальные деньги):**

| Набор | Содержимое | Цена (капли) | Цена ($) |
|-------|------------|--------------|----------|
| Starter | 5 Bronze + 1 Silver | 200 | $1.99 |
| Booster | 3 Gold | 800 | $4.99 |
| Finisher | 2 Gold + 100 клея | 600 | $3.99 |

**Ограничения:**
- Starter: 1 раз за сезон
- Booster: 3 раза за сезон
- Finisher: доступен только в последнюю неделю, 2 раза

**VIP-бонус:**
- +1 Bronze-пак в ежедневный сундук (итого 2 Bronze/день)
- Соответствует текущим VIP-бонусам (+25% XP, без рекламы и т.д.)

**Premium Battle Pass:**
- Включает паки альбома (см. раздел 12.3.4)
- Rainbow-пак на уровне 30 — главный стимул покупки

#### 12.3.10. Целевые метрики

| Метрика | Цель |
|---------|------|
| Участие в альбоме | 60-80% активных игроков |
| Собрали ≥50% | 25-40% участников |
| Собрали ≥80% | 10-15% участников |
| Закрыли 100% | 5-10% участников |

**Ожидаемое поведение:**
- F2P активный (ежедневно, все задания): 70-90% альбома
- Покупатель пропуска: 85-100% альбома
- Покупатель пропуска + Finisher: 100% альбома

#### 12.3.11. Баланс получения паков

**Расчёт на 28 дней (активный F2P):**

| Источник | Паков за сезон | Тип |
|----------|----------------|-----|
| Ежедневный сундук | 28 | Bronze |
| 2/3 ежедневных | 28 | Bronze |
| 3/3 ежедневных | 14 (50% дней) | Bronze |
| Еженедельные (по 3) | 12 | Silver |
| Все 3 еженедельных | 4 | Gold |
| Сундук арены (3/день) | 60 | Bronze |
| Free пропуск | 8 Bronze + 4 Silver | — |
| **Итого** | ~138 Bronze + 16 Silver + 4 Gold | — |

**Ожидаемые карты:**
- Bronze (138 паков × 3 карты × ~60% новых): ~250 открытий, ~100 уникальных (с учётом дублей)
- С учётом pity и Silver/Gold: реалистично 40-45 уникальных карт
- Для 100% нужен Premium пропуск или покупки

**Баланс дубликатов:**
- При 50 картах и 200+ открытий: много дублей в конце
- Дубли → клей → Gold-пак (гарантия новой) — путь к закрытию

---

## 13. Достижения и задания

### 13.1. Достижения (одноразовые)

| Достижение | Условие | Награда |
|------------|---------|---------|
| Первый укус | Съесть первый пузырь | 10 капель |
| Первая кровь | Убить первого врага | 20 капель |
| Победитель | Занять 1 место | 50 капель |
| Гигант | Достичь массы 1000 | 30 капель |
| Титан | Достичь массы 5000 | 100 капель |
| Охотник на боссов | Убить босса | 50 капель + рамка |
| Босс | Сыграть за босса и выжить до конца | 100 капель + титул |
| Выживший | Выжить 5 матчей подряд без смерти | 100 капель |
| Собиратель | Съесть 100 пузырей за матч | 30 капель |
| Командный игрок | Победить в 10 командных матчах | 50 капель + титул |
| Ветеран | Сыграть 100 матчей | 200 капель + скин |
| Убийца гигантов | Убить 10 Мятежников | 100 капель + титул |
| Последний вздох | Нанести урон в фазе «Последний вздох» 5 раз | 50 капель |

**Повторное выполнение:** нет. Достижения одноразовые.

**Отображение прогресса:** полоска под названием достижения в профиле.

### 13.2. Ежедневные задания

| Задание | Условие | Награда |
|---------|---------|---------|
| Активный игрок | Сыграть 3 матча | 20 капель |
| Охотник | Убить 5 врагов | 30 капель |
| Собиратель | Съесть 200 пузырей | 25 капель |
| Выживание | Занять топ-3 дважды | 40 капель |

**Обновление:** каждые 24 часа в 00:00 UTC.

**Количество активных:** 3 задания в день (случайные из пула).

**Пропуск дня:** задания сбрасываются, не накапливаются.

### 13.3. Еженедельные задания

| Задание | Условие | Награда |
|---------|---------|---------|
| Марафонец | Сыграть 20 матчей | 100 капель |
| Мастер | Занять 1 место 5 раз | 150 капель |
| Разнообразие | Сыграть каждым классом (мин. 3 матча) | 80 капель |
| Убийца гигантов | Убить 3 Мятежников | 120 капель |

**Обновление:** каждый понедельник в 00:00 UTC.

**Количество активных:** 3 задания в неделю (случайные из пула).

---

## 14. Монетизация

### 14.1. Принцип

**Pay-to-Customize.** Платные элементы не дают преимущества в бою.

### 14.2. Источники в MVP

| Источник | Описание |
|----------|----------|
| Магазин косметики | Скины, эффекты за капли или реальные деньги |
| Реклама за награду | ×2 капли после матча |
| Ежедневный сундук | Бесплатный сундук за вход |

### 14.3. Источники после MVP

| Источник | Описание |
|----------|----------|
| Сезонный пропуск | 30 уровней, бесплатная + премиум ветка |
| Подписка VIP | Без рекламы, +50% капли, эксклюзивный скин/месяц |
| Капсулы | Случайная косметика (с pity) |

### 14.4. Ежедневный бесплатный сундук

**Механика:**
- Один бесплатный сундук каждые 24 часа
- Содержимое: 10–50 капель ИЛИ обычный косметический предмет (90%/10%)
- Просмотр рекламы удваивает награду
- Таймер виден в главном меню (обратный отсчёт)

**Редкие награды:**
- 1% шанс на редкий предмет
- 0.1% шанс на эпический предмет

**Цель:** ежедневное удержание, привычка заходить каждый день.

### 14.5. Сезонный пропуск (структура)

**Длительность сезона:** 4 недели.

**Уровней:** 30.

**Опыт за уровень:** 1000 XP.

**Источники опыта:**

| Источник | XP |
|----------|-----|
| Матч сыгран | 50 |
| Топ-3 | +100 |
| Победа | +200 |
| Ежедневное задание | 100 |
| Еженедельное задание | 300 |

**Структура наград:**

| Уровень | Бесплатная ветка | Премиум ветка |
|---------|------------------|---------------|
| 1–10 | Капли (50–100 за уровень) | Обычные скины (5 штук) |
| 11–20 | Редкий скин (ур.15), капли | Редкие скины (3 штуки), эффекты |
| 21–29 | Капли, рамки | Эпические скины (2 штуки) |
| 30 | Титул сезона | Легендарный скин |

**Стоимость премиум-пропуска:** 500 капель или $4.99.

**Догнать пропуск:** да. Опыт копится независимо от покупки. Можно купить пропуск в последний день и получить все накопленные награды.

**Невыкупленные награды:** сгорают после сезона (премиум ветка). Бесплатные награды тоже сгорают.

**Покупка уровней:** 100 капель за уровень (для тех, кто хочет ускорить прогресс).

### 14.6. Что продаётся

| Категория | Примеры | Цена (капли) |
|-----------|---------|--------------|
| Тело | Цвет, градиент, текстура | 50–500 |
| Глаза | Форма, цвет, анимация | 30–300 |
| Рот | Улыбка, клыки, язык | 30–300 |
| Аксессуары | Шляпа, очки, бант | 100–1000 |
| След | Цвет, частицы | 200–800 |
| Аура | Свечение вокруг | 300–1500 |
| Рамка профиля | Окантовка аватара | 100–500 |
| Титул | Текст под ником | 200–1000 |

### 14.7. Влияние на читаемость

Косметика **не влияет** на визуальную читаемость размера. Хитбокс и зоны (пасть/хвост) одинаковы для всех скинов.

**Правила для косметики:**
- Максимальный размер аксессуара: +10% к радиусу (только визуально)
- След не превышает 50 единиц длины
- Аура не более 20% от радиуса слайма

### 14.8. Запрещено продавать

- Любые боевые преимущества
- Таланты
- Умения
- Классы (все бесплатны)
- XP-бустеры (только через VIP)

### 14.9. Капсулы (после MVP)

**Типы:**

| Тип | Стоимость | Содержимое |
|-----|-----------|------------|
| Обычная | 100 капель / $0.99 | 1 обычный–редкий предмет |
| Премиум | 300 капель / $2.99 | 1 редкий–эпический предмет |
| Легендарная | 1000 капель / $9.99 | 1 эпический–легендарный предмет |

**Гарантии (pity):**
- Эпический: гарантирован после 50 обычных капсул без эпического
- Легендарный: гарантирован после 100 обычных капсул без легендарного

**Дубликаты:** конвертируются в осколки.
- Обычный: 10 осколков
- Редкий: 30 осколков
- Эпический: 100 осколков
- Легендарный: 500 осколков

**Обмен осколков:** 500 осколков = выбор любого предмета той же редкости.

### 14.10. VIP-подписка (после MVP)

| Бонус | Описание |
|-------|----------|
| Без рекламы | Полное отключение рекламы |
| +50% капель | За все источники (матчи, задания) |
| +25% XP | Для сезонного пропуска |
| Эксклюзивный скин | 1 уникальный скин каждый месяц |
| Значок VIP | Золотая звезда у ника |
| Приоритетный поиск | Быстрее находит матчи |

**Стоимость:** $4.99/месяц или $39.99/год.

**Отмена:** в любой момент, доступ до конца оплаченного периода.

---

## 15. Кланы (после MVP)

### 15.1. Создание клана

| Параметр | Значение |
|----------|----------|
| Стоимость создания | 500 капель |
| Максимум участников | 30 |
| Минимум для активности | 5 |
| Название | 3–16 символов, уникальное |
| Тег | 2–4 символа, отображается у ника |

### 15.2. Роли в клане

| Роль | Права |
|------|-------|
| Глава | Все права, передача лидерства, роспуск клана |
| Офицер | Приглашение, исключение рядовых, объявление войн |
| Рядовой | Участие в войнах, клановый чат |

### 15.3. Клановые сезоны

- Длительность: 4 недели (совпадает с сезоном рейтинга)
- Очки клана = сумма лучших результатов 10 участников за неделю
- Бонус за активность: +10% очков, если 20+ участников играли на неделе

**Лиги кланов:**

| Лига | Очки |
|------|------|
| Бронза | 0–4999 |
| Серебро | 5000–14999 |
| Золото | 15000–29999 |
| Платина | 30000–49999 |
| Алмаз | 50000+ |

**Награды по итогам сезона:**

| Лига | Награда каждому участнику |
|------|---------------------------|
| Бронза | 100 капель |
| Серебро | 200 капель + клановая рамка |
| Золото | 500 капель + клановый скин |
| Платина | 1000 капель + эпический скин |
| Алмаз | 2000 капель + легендарный скин + титул |

### 15.4. Клановые войны (после Альфы)

**Формат:**
- 5v5 командные матчи
- Без респауна (смерть = выбывание)
- Победа: последняя выжившая команда или бо́льшая суммарная масса через 3 минуты

**Расписание:**
- Окно для войн: пятница–воскресенье
- Матчмейкинг по рейтингу клана
- Максимум 3 войны в день на клан

**Награды:**
- Победа: +500 очков клана, +50 капель каждому участнику
- Поражение: +100 очков клана, +10 капель каждому участнику

---

## 16. Интерфейс

### 16.1. HUD (всегда на экране)

| Элемент | Позиция | Описание |
|---------|---------|----------|
| HP/Масса/Уровень | Левый верх | Числа + полоска |
| Таймер | Верх по центру | Время до конца матча |
| Фаза | Под таймером | Название текущей фазы |
| Топ-3 | Правый верх | Ники + масса (Мятежник выделен красным) |
| Джойстик | Левый низ (адаптивный) | Виртуальный |
| Кнопки умений | Правый низ | 1-3 кнопки |
| Индикатор талантов | Над кнопками умений | «+N» если есть непрокачанные |
| Метка Мятежника | Динамическая | Стрелка к Мятежнику за экраном |
| Индикатор голода | Рядом со слаймом | Иконка + визуальные эффекты |

### 16.2. Индикация умений

| Состояние | Визуал |
|-----------|--------|
| Готово | Яркая иконка, лёгкое свечение |
| На КД | Затемнение + круговой таймер |
| Не хватает массы | Красная обводка |
| В очереди (GCD) | Пульсирующая обводка |

### 16.3. Отображение зон слайма

- Направление пасти: стрелка-индикатор над слаймом
- Хвост: не отображается явно (понятно интуитивно)
- При атаке: зона пасти подсвечивается жёлтым

### 16.4. Индикаторы за экраном

**Вместо миникарты — стрелки-индикаторы:**

| Цвет | Объект | Приоритет |
|------|--------|-----------|
| Красный | Враги | Низкий |
| Жёлтый | Сундуки | Средний |
| Зелёный | Hot Zones | Высокий |
| Фиолетовый с короной | Мятежник | Высший |

**Правила:**
- Показываются только ближайшие 5 объектов
- Размер стрелки зависит от расстояния (ближе = больше)
- Стрелка к Мятежнику всегда видна

### 16.5. Подсказки для новичка

Первые 3 матча показывают подсказки:

| Момент | Подсказка |
|--------|-----------|
| 0 сек | «Двигайте джойстик» |
| 5 сек | «Ешьте пузыри пастью» |
| 30 сек | «Атакуйте врагов в хвост» |
| Первая смерть | «Вы можете отомстить! Атакуйте в последний момент» |
| Первый талант | «Выберите талант или он выберется автоматически» |

**Отключение:** в настройках или после 3 матчей.

### 16.6. Экран окончания матча

**Юмористические титулы** в зависимости от результата:

| Условие | Титул |
|---------|-------|
| 1 место | «Король слизи» 👑 |
| 2-3 место | «Почти вкусный» 🥈 |
| Много убийств (5+) | «Голодный хищник» 🦈 |
| Мало убийств, много массы | «Мирный гигант» 🐘 |
| Много смертей (5+) | «Вкусная закуска» 🍰 |
| 0 убийств | «Пацифист» ☮️ |
| Убил Мятежника | «Убийца гигантов» ⚔️ |
| Был Мятежником и выжил | «Народный враг» 😈 |
| Последний вздох сработал | «Не сдаётся!» 💪 |
| Максимум массы за всё время | «Новый рекорд!» 🏆 |

**Структура экрана:**
1. Титул (крупно, анимированно, по центру)
2. Место и масса
3. Статистика (убийства, съедено пузырей, нанесённый урон, время выживания)
4. Награды (XP, капли, прогресс заданий)
5. Кнопка «Ещё раз» (крупная, зелёная)
6. Кнопка «В меню» (мелкая, серая)

---

## 17. Коммуникация

### 17.1. Быстрые сообщения

| Сообщение | Назначение | Иконка |
|-----------|------------|--------|
| «Привет!» | Приветствие | 👋 |
| «Отлично!» | Похвала | 👍 |
| «Помогите!» | Запрос помощи (командный) | ❗ |
| «Вместе на босса!» | Координация (режим босса) | 🎯 |
| «Извините» | Извинение | 😅 |
| «Ура!» | Радость | 🎉 |

**Настройка набора:** нет в MVP. Фиксированный список.

**Кулдаун:** 3 сек между сообщениями (защита от спама).

**Отображение:** облачко над слаймом на 2 сек.

### 17.2. Система репортов

| Категория | Описание |
|-----------|----------|
| Читы | Подозрение на взлом |
| Оскорбления | Токсичное поведение (ники) |
| AFK | Бездействие в матче |
| Сговор | Договорные матчи |

**Обработка:**
- Автоматическая при накоплении 5+ репортов за 24 часа
- Ручная модерация для спорных случаев
- Наказания: предупреждение → мут → временный бан → перманентный бан

---

## 18. Визуальный стиль

### 18.1. Общий стиль

- Яркий, дружелюбный, мультяшный
- Границы юмора: детский/семейный (без насилия, крови, агрессии)
- Референсы: Slime Rancher, Cut the Rope, Angry Birds

### 18.2. Анимации слайма

| Действие | Анимация |
|----------|----------|
| Движение | Вытягивание в направлении |
| Торможение | Сплющивание |
| Столкновение | Волна по телу |
| Укус | Раскрытие «пасти», глотательное движение |
| Получение урона | Сжатие + красная вспышка |
| Смерть | Разлёт на капли |
| Последний вздох | Мигание, полупрозрачность, распадающиеся частицы |
| Рост (уровень) | Пульсация + искры |

### 18.3. Эффекты умений

| Умение | Эффект |
|--------|--------|
| Рывок | След из частиц того же цвета, что слайм |
| Выброс | Летящий шар + искры при попадании |
| Щит | Полупрозрачный купол с рябью |
| Притяжение | Линии-лучи к пузырям |

### 18.4. Визуализация «голода»

- Слайм тускнеет (−30% насыщенности)
- Появляются капли «пота» (анимированные)
- Края экрана затемняются (виньетка)
- Периодическое «урчание» (звук)

### 18.5. Визуализация Мятежника

- Красная корона над слаймом
- Красное свечение вокруг
- Метка на HUD всех игроков
- Оповещение при получении/потере статуса

---

## 19. Производительность и оптимизация

### 19.1. Лимиты объектов

| Объект | Максимум на карте |
|--------|-------------------|
| Слаймы (игроки + боты) | 20 |
| Пузыри | 150 |
| Снаряды (от умений) | 50 |
| Частицы (визуальные) | 200 |
| Сундуки | 5 |

### 19.2. Оптимизация рендеринга

| Техника | Описание |
|---------|----------|
| Culling | Не рисовать объекты за пределами видимой области |
| LOD | Упрощённые спрайты для далёких объектов |
| Batching | Группировка однотипных спрайтов |
| Object pooling | Переиспользование объектов вместо создания новых |

### 19.3. Упрощённый режим графики

Для слабых устройств (автоопределение или ручной выбор):

| Настройка | Полная | Упрощённая |
|-----------|--------|------------|
| Частицы | Все | 50% |
| Тени | Есть | Нет |
| Деформация слайма | Полная | Базовая |
| След движения | Есть | Нет |
| Размытие фона | Есть | Нет |
| Эффекты умений | Полные | Упрощённые |

### 19.4. Целевая производительность

| Устройство | FPS | Tick rate |
|------------|-----|-----------|
| Флагман (2023+) | 60 | 30 |
| Средний (2020+) | 30 | 30 |
| Слабый (2018+) | 30 (упрощённый режим) | 30 |

### 19.5. Сетевая оптимизация

| Параметр | Значение |
|----------|----------|
| Snapshot rate | 10–20 Гц |
| Snapshot размер (p99) | < 2 КБ |
| Input rate | 30 Гц |
| Квантование координат | float16 (позже) |
| Интерполяция | Линейная, 100 мс буфер |

---

## 20. Метрики и баланс

### 20.1. Целевые показатели

| Метрика | Цель |
|---------|------|
| Время до уровня 3 | 30–45 сек |
| Время до первой смерти | 45–60 сек |
| Убийств на игрока за матч | 1–3 |
| Топ-1 масса / средняя | < 5× |
| Использование «Последний вздох» | 20–30% смертей |
| Появление Мятежника | 70% матчей |

### 20.2. Красные линии

| Ситуация | Недопустимо |
|----------|-------------|
| Доминирование | 1 игрок стабильно убивает 5+ без шанса |
| «Снежный ком» | Топ-1 > 50% суммарной массы |
| Скука | < 1 убийства за матч в среднем |
| Фрустрация | > 30% игроков выходят после первой смерти |

### 20.3. Параметры для config (обязательно)

- Спавн пузырей: количество, интервал, распределение
- Физика: все параметры из раздела 2.6.2
- Фазы: длительность каждой
- Голод: сила, нарастание, максимум
- Умения: стоимость, КД, эффекты
- Таланты: эффекты, вероятности
- Мятежник: порог, награды
- Последний вздох: длительность, урон

---

## 21. Крайние случаи матча

### 21.1. Ничья

При одинаковой массе у двух игроков побеждает тот, кто достиг этой массы раньше.

### 21.2. Один игрок

Если в матче остался 1 игрок:
- Если прошло > 1 минуты: техническая победа
- Если прошло < 1 минуты: ожидание 30 сек, затем отмена

### 21.3. Отключение игрока

**Обычный игрок:**
- Слайм останавливается и становится уязвимым (не призраком!)
- Через 10 сек без переподключения: автоматическая смерть
- Масса разлетается в пузыри как при обычной смерти
- Попытка переподключения: 30 сек

**Защита от злоупотреблений:**
- Лидеры (топ-3 по массе) **не получают защиты** при отключении
- Их слайм остаётся уязвимым и управляется ИИ (движение к центру)
- Если лидер отключился в последние 30 сек матча — его позиция засчитывается как есть, без защиты

**Намеренное отключение:**
- Если игрок часто отключается (>3 раз за сессию) — временный бан на поиск матчей (5 мин)
- При повторных нарушениях: 15 мин, 1 час, 24 часа

### 21.4. Все избегают боя

Эффект «голод» вынуждает идти в Hot Zone. Если все сидят в зоне — неизбежны столкновения из-за ограниченного пространства.

### 21.5. Массовое отключение

Если > 50% игроков отключились — матч отменяется. Рейтинг не меняется.

---

## 22. MVP

### 22.1. Внутренний MVP (проверка ядра)

**Что проверяем:**
- Ощущение от управления (инерция, дрифт, адаптивный джойстик)
- Удовлетворение от поедания пузырей
- Читаемость боя (пасть/хвост)
- Механика «Последний вздох»

**Критические параметры для теста:**
1. `collisionRestitution` — упругость
2. `orbLinearDamping` — затухание пузырей
3. `maxTurnRate` — скорость поворота
4. `lastBreathDuration` — длительность «Последнего вздоха»

**Первое умение:** Выброс (дальняя атака для разнообразия).

**Первый режим:** FFA.

**Допустимые баги:**
- Визуальные артефакты
- Неточный баланс
- Редкие вылеты

**Недопустимые баги:**
- Невозможность закончить матч
- Массовые отключения
- Читы

### 22.2. Метрики для Internal MVP

| Метрика | Цель |
|---------|------|
| Матчей без падений | > 95% |
| Tick < 20 мс | > 99% |
| «Хочу ещё» (опрос) | > 70% |
| «Управление удобное» (опрос) | > 80% |

### 22.3. Публичный MVP

**Обязательно:**
- Лобби + поиск
- Гостевой вход
- Профиль + ник
- Рейтинг (упрощённый)
- Быстрые сообщения
- 10 достижений
- 5 скинов + валюта
- Rewarded Ads
- Ежедневный бесплатный сундук
- Адаптивный джойстик
- Механика «Последний вздох»
- Система «Мятежник»
- Юмористические титулы

---

## 23. Риски

| Риск | Смягчение |
|------|-----------|
| Сложное управление | Адаптивный джойстик, дрифт как опция, туториал |
| «Снежный ком» | Логарифмические формулы, система Мятежник, мониторинг |
| Хаотичные пузыри | Настройка физики, `maxOrbSpeed` |
| Сложность частичного поглощения | Сначала полное, частичное позже |
| Сетевые задержки | Тесты на ранних этапах |
| Низкое удержание | Кланы, энциклопедия, сезонные события |
| Фрустрация от смерти | Последний вздох, быстрый респаун, юмористические титулы |

---

## 24. Глоссарий

| Термин | Определение |
|--------|-------------|
| `heading` | Направление «пасти» слайма (вектор) |
| `eatingPower` | Пожирательная способность (число) |
| `swallowLimit` | Порог полного проглатывания (масса пузыря) |
| `biteFraction` | Доля откусываемой массы (0–1) |
| `pity` | Гарантия выпадения редкого предмета после серии неудач |
| Hot Zone | Горячая зона с бонусным спавном пузырей |
| Мятежник | Самый крупный слайм с меткой и наградой за убийство |
| Последний вздох | Шанс на контратаку в течение 0.5 сек после смерти |
| GCD | Global Cooldown — глобальный кулдаун между умениями |
| Сезонный альбом | Временная коллекция карт на 28 дней с уникальными наградами |
| Пак | Набор случайных карт альбома (Bronze/Silver/Gold/Rainbow) |
| Слайм-клей | Сезонная валюта из дубликатов карт, обменивается на паки |
| Сундук арены | Источник паков за накопленную массу в матчах |
| Бейдж сезона | Косметическая награда за 100% альбома, отображается в профиле |

---

## Приложение A. Пользовательские сценарии

### A.1. Новичок (первый матч)

1. Запускает игру → гостевой вход
2. Нажимает «Играть» → поиск матча
3. Спавн со щитом → читает подсказку про джойстик
4. Касается экрана → джойстик появляется под пальцем (адаптивный)
5. Двигает джойстик → слайм движется с инерцией
6. Видит пузырь → подъезжает пастью → поглощает
7. Масса растёт → визуально увеличивается
8. Встречает врага → получает урон в хвост → удивлён
9. Умирает → видит мигание «Последний вздох» → пытается укусить врага
10. Респавн со щитом → понимает механику
11. Видит Мятежника (красная корона) → охотится на него
12. Матч заканчивается → видит титул «Вкусная закуска» → улыбается → «ещё раз»

### A.2. Средний игрок (10+ матчей)

1. Выбирает Охотника → знает его сильные стороны
2. Быстро собирает пузыри → использует дрифт для эффективности
3. Охотится на мелких → заходит в хвост
4. Получает уровень → выбирает талант на скорость
5. Использует Рывок для добивания
6. Замечает Мятежника → охотится за наградой +50% массы
7. В финале идёт в Hot Zone → борется за топ-3
8. Получает титул «Убийца гигантов» → доволен

### A.3. Мастер (100+ матчей)

1. Выбирает класс под режим и карту
2. Оптимизирует маршрут сбора с учётом биомов
3. Использует дрифт-контратаки
4. Строит синергичный билд талантов
5. Контролирует Hot Zone, избегая Мятежника до подходящего момента
6. Знает тайминги фаз наизусть
7. Использует «Последний вздох» тактически — провоцирует врага на добивание
8. Участвует в клановых войнах, закрывает сезонный альбом
9. Ведёт клан в лигу Алмаз
10. Собирает бейджи прошлых сезонов

---

## Приложение B. Источники рекомендаций v2.1 и v2.2

Изменения версий основаны на сравнительном анализе популярных игр:

**Версия 2.1 (анализ .io-игр):**

| Игра | Заимствованные механики |
|------|------------------------|
| Agar.io | Ежедневные бонусы, простота, минималистичный UI |
| Slither.io | Честный баланс, отсутствие P2W, механика «большой = медленный» |
| Little Big Snake | Кланы, квесты, Rebel-механика, Juja (прообраз «Последнего вздоха») |
| ZombsRoyale.io | Battle Pass, сезоны, адаптивный UI, юмор |
| Surviv.io | Ежедневные задания, временные события |
| Mope.io | Биомы, коллекционирование, пищевая цепочка |
| Wormax.io | VIP-подписка без P2W |
| Diep.io | Глубина геймплея, выбор веток развития |
| Mitos.is | Гильдии, турниры, сезоны |
| EvoWars.io | Простота, скины, визуальная эволюция |

**Версия 2.2 (анализ сезонных коллекций):**

| Игра | Заимствованные механики |
|------|------------------------|
| Royal Match | Сезонный альбом карт, типы паков (Bronze/Silver/Gold), pity-система, конвертация дублей в валюту, обмен валюты на паки, бейджи за полный сбор |
| Monopoly GO | Стикер-альбомы как мета-петля удержания |

---

## Приложение C. Конфигурационные параметры

Полный список параметров для `config.json`:

```
// Джойстик
joystickMode: "adaptive" | "fixed"
joystickRadius: 60-140
joystickDeadzone: 0.05-0.20
joystickSensitivity: 0.5-2.0
joystickFollowSpeed: 0.5-1.0

// Дрифт
driftThresholdAngle: 90-150
driftDuration: 0.2-0.5
driftSpeedLoss: 0.3-0.7
driftCooldown: 0.3-1.0

// Физика
environmentDrag: 0.01-0.10
collisionRestitution: 0.2-0.8
slimeLinearDamping: 0.01-0.05
orbLinearDamping: 0.03-0.15
collisionImpulseCap: 5000-50000
maxOrbSpeed: 500-2000
maxSlimeSpeed: 300-1000
speedDampingRate: 0.1-0.3

// Последний вздох
lastBreathDuration: 0.3-0.8
lastBreathDamageMultiplier: 0.3-0.7
lastBreathSpeedMultiplier: 0.5-1.0
lastBreathOrbBonus: 0.05-0.15

// Мятежник
rebelMassThreshold: 1.3-2.0
rebelUpdateInterval: 3-10
rebelKillMassBonus: 0.3-0.7
rebelKillSpeedBuff: 0.05-0.20
rebelKillSpeedBuffDuration: 5-15
rebelDeathOrbPercent: 0.35-0.50

// Голод
hungerBaseDrain: 0.005-0.02
hungerScaling: 0.002-0.01
hungerStartTime: 90-120
hungerMaxDrain: 0.03-0.08

// Спавн
orbInitialCount: 80-120
orbMaxCount: 120-180
orbRespawnInterval: 0.3-1.0
chestMaxCount: 2-5
chestSpawnInterval: 15-30

// Фазы (секунды)
phaseSpawnDuration: 10-20
phaseCollectDuration: 40-60
phaseHuntDuration: 25-35
phaseChaosDuration: 25-35
phaseFinalDuration: 25-35

// Сезонный альбом (после MVP)
albumCardsPerSeason: 40-60
albumPagesCount: 4-6
albumSeasonDuration: 28
albumCommonCount: 25-35
albumRareCount: 10-15
albumEpicCount: 4-8
albumLegendaryCount: 1-3

// Паки альбома
packBronzeCards: 3
packSilverCards: 4
packGoldCards: 5
packRainbowCards: 6

// Вероятности (Bronze-пак)
packCommonChance: 0.70-0.80
packRareChance: 0.15-0.25
packEpicChance: 0.03-0.06
packLegendaryChance: 0.003-0.008

// Pity-система
pityNewCardThreshold: 3-6
pityEpicThreshold: 15-30
pityLegendaryThreshold: 40-70

// Слайм-клей
glueCommonValue: 1
glueRareValue: 4-6
glueEpicValue: 15-25
glueLegendaryValue: 80-120
glueToCurrencyRate: 0.1

// Обмен клея
glueBronzePackCost: 40-60
glueSilverPackCost: 120-180
glueGoldPackCost: 350-450

// Сундук арены (масса для Bronze-пака по лигам)
arenaChestMassDroplet: 400-600
arenaChestMassSlug: 600-900
arenaChestMassSlime: 800-1200
arenaChestMassGiant: 1200-1800
arenaChestMassTitan: 1600-2400
arenaChestMassLegend: 2000-3000
arenaChestMaxPerDay: 3-6
```

---

## Приложение D. Технические требования для архитектора (Сезонный альбом)

Данное приложение содержит технические заметки для проектирования серверной архитектуры с учётом будущего расширения «Сезонный альбом».

### D.1. Серверные сущности

**SeasonConfig (конфигурация сезона):**
```
{
  seasonId: string,           // "season_2025_winter"
  startDate: timestamp,
  endDate: timestamp,
  albumConfig: {
    totalCards: number,       // 50
    rarityDistribution: {
      common: number,         // 30
      rare: number,           // 12
      epic: number,           // 6
      legendary: number       // 2
    },
    pages: PageConfig[]
  },
  packConfigs: PackConfig[],
  pityConfig: PityConfig,
  glueConfig: GlueConfig
}
```

**PlayerAlbumState (состояние альбома игрока):**
```
{
  odlayerId: string,
  seasonId: string,
  collectedCards: Set<cardId>,      // собранные карты
  glueBalance: number,              // текущий баланс клея
  pityCounters: {
    packsSinceNewCard: number,
    packsSinceEpic: number,
    packsSinceLegendary: number
  },
  arenaChestProgress: {
    currentMass: number,            // накопленная масса
    packsClaimedToday: number,
    lastResetDate: date
  },
  packsOpened: number,              // для статистики
  lastPackOpenedAt: timestamp
}
```

**CardDefinition (определение карты):**
```
{
  cardId: string,                   // "season_winter_card_001"
  seasonId: string,
  pageIndex: number,
  rarity: enum(common|rare|epic|legendary),
  artAssetId: string,
  nameKey: string,                  // ключ локализации
  flavorTextKey: string
}
```

**PackOpenResult (результат открытия пака):**
```
{
  packType: enum(bronze|silver|gold|rainbow),
  cards: [
    {
      cardId: string,
      isNew: boolean,
      glueAwarded: number           // 0 если новая, >0 если дубль
    }
  ],
  pityTriggered: {
    newCard: boolean,
    epic: boolean,
    legendary: boolean
  }
}
```

### D.2. API-эндпоинты

| Метод | Endpoint | Описание |
|-------|----------|----------|
| GET | `/album/state` | Текущее состояние альбома игрока |
| GET | `/album/cards` | Список всех карт сезона с статусом |
| POST | `/album/pack/open` | Открыть пак (body: packType, source) |
| POST | `/album/glue/exchange` | Обменять клей на пак |
| GET | `/album/rewards` | Доступные награды за страницы |
| POST | `/album/rewards/claim` | Забрать награду за страницу |
| POST | `/album/arena-chest/claim` | Забрать пак из сундука арены |

### D.3. События для аналитики

| Событие | Параметры | Когда |
|---------|-----------|-------|
| `album_pack_opened` | packType, source, cardsReceived[], newCardsCount, glueReceived | При открытии пака |
| `album_card_collected` | cardId, rarity, isFromPity, packType | При получении новой карты |
| `album_page_completed` | pageIndex, totalProgress | При закрытии страницы |
| `album_completed` | totalPacks, totalGlueSpent, daysToComplete | При 100% |
| `album_glue_exchanged` | glueSpent, packType | При обмене клея |
| `album_arena_chest_claimed` | massAccumulated, league | При получении пака арены |
| `album_season_end` | progress, cardsCollected, glueConverted | При завершении сезона |

### D.4. Интеграции с существующими системами

**С системой матчей:**
- После каждого матча: обновить `arenaChestProgress.currentMass`
- Событие `match_ended` должно содержать `totalMassCollected`

**С системой заданий:**
- Задания награждают паками через `grantPack(playerId, packType, source)`
- Источник важен для аналитики: "daily_quest", "weekly_quest", "battle_pass"

**С Battle Pass:**
- Награды пропуска включают паки альбома
- При клейме награды: вызов `grantPack` с source="battle_pass_free" или "battle_pass_premium"

**С кланами:**
- При завершении кланового сезона: массовая выдача паков участникам
- Batch-операция: `grantPackToClanMembers(clanId, packType, minActivity)`

**С ежедневным сундуком:**
- Существующий сундук дополняется Bronze-паком
- Rewarded-ad удваивает пак (2 Bronze вместо 1)

### D.5. Миграция между сезонами

**При старте нового сезона:**
1. Конвертировать `glueBalance` → капли (курс из config)
2. Архивировать `PlayerAlbumState` в `PlayerAlbumHistory`
3. Создать новый `PlayerAlbumState` с нулевыми счётчиками
4. Начислить награды за незабранные страницы (если не забрали вручную)

**PlayerAlbumHistory:**
```
{
  playerId: string,
  seasonId: string,
  finalProgress: number,          // 0.0-1.0
  cardsCollected: number,
  badgeAwarded: boolean,
  completedAt: timestamp | null,
  rewards: RewardRecord[]
}
```

### D.6. Нагрузочные требования

| Операция | Ожидаемая частота | Требование |
|----------|-------------------|------------|
| Открытие пака | 5-10 на игрока/день | < 100ms latency |
| Проверка прогресса | При каждом входе в меню | Кешировать на клиенте |
| Обновление сундука арены | После каждого матча | Включить в существующий `match_result` |
| Миграция сезона | 1 раз в 28 дней | Batch job, допустимо 1-2 часа даунтайма |

### D.7. Клиентские требования

**Кеширование:**
- `CardDefinition[]` — кешировать на весь сезон
- `PlayerAlbumState` — обновлять после каждого действия
- Ассеты карт — предзагружать при входе в меню альбома

**Оффлайн-поведение:**
- Альбом недоступен оффлайн (все операции серверные)
- При потере связи во время открытия пака — retry с idempotency key

**UI-состояния:**
- Пустой альбом (начало сезона)
- Частично заполнен
- Страница закрыта (анимация + награда)
- Альбом закрыт (celebration screen)
- Сезон завершён (архивный просмотр)

### D.8. Структура хранилища данных

**Таблица сезонов (album_seasons):**
- Хранит конфигурацию каждого сезона с датами начала и завершения
- Уникальный идентификатор сезона служит первичным ключом
- Содержит флаг активности и полную конфигурацию (распределение редкости, биомы, pity-параметры)

**Таблица карт (album_cards):**
- Каждая карта связана с сезоном через внешний ключ
- Содержит порядковый номер страницы, редкость, идентификатор ассета
- Первичный ключ — уникальный идентификатор карты
- Требует индекс по сезону для быстрого поиска карт в рамках сезона

**Таблица состояния альбома игрока (player_album_state):**
- Хранит текущий прогресс игрока в активном сезоне
- Составной первичный ключ: ID игрока + ID сезона
- Содержит список собранных карт, баланс клея, счётчики pity по категориям
- Хранит прогресс сундука арены (накопленная масса, количество забранных паков сегодня)
- Требует индекс по сезону для выборки всех игроков в рамках сезона

**Таблица истории альбома (player_album_history):**
- Архивирует состояние альбома игрока при завершении сезона
- Составной первичный ключ: ID игрока + ID сезона
- Содержит финальный прогресс (от 0 до 1), количество собранных карт, статус получения бейджа
- Сохраняет временную метку завершения для аналитики

**Индексирование:**
- На поле сезона в таблицах состояния и карт для оптимизации выборок
- На дате последнего обновления для быстрого поиска недавних изменений (опционально)
- На ID игрока в истории для отчётов об активности игроков
