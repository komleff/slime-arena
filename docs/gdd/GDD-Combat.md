# Slime Arena — Combat

**Версия:** 3.3.2  
**Дата:** 03.01.2026  
**Зависимости:** GDD-Core.md (константы, классы)  
**Глоссарий:** [GDD-Glossary.md](GDD-Glossary.md)  

---

## 1. Зоны слайма

### 1.1. Секторы

| Зона | Угол | Свойства |
|---|---:|---|
| Пасть | 120° спереди | Наносит урон, поглощает пузыри |
| Бока | По 60° с каждой стороны | Только отскок, стандартный урон |
| Хвост | 120° сзади | Получает полуторный урон |

### 1.2. Визуальное представление

```
        ┌─────────┐
       /   ПАСТЬ   \      ← 120°
      /    (урон)   \
     ├───┬───────┬───┤
     │БОК│       │БОК│    ← 60° + 60°
     │   │       │   │
     └───┴───────┴───┘
          \     /
           \   /
            \ /          ← 120°
           ХВОСТ
         (×1.5 урон)
```

---

## 2. Механика укуса

### 2.1. Базовый параметр

`biteMassPercent = 10%` — процент от собственной массы, который слайм откусывает за один укус.

### 2.2. Расчёт размера укуса

```
размер укуса = масса слайма × biteMassPercent × модификатор класса × модификаторы талантов
```

**Модификаторы классов:**

| Класс | Модификатор укуса | Применяется к |
|---|---|---|
| Охотник | ×1.0 | Всё |
| Воин | ×1.1 (+10%) | Только слаймы |
| Собиратель | ×1.25 (+25%) | Только пузыри |

### 2.3. Укус пузыря

1. Рассчитать размер укуса по формуле.
2. Если масса пузыря ≤ размер укуса: пузырь проглатывается целиком.
3. Если масса пузыря > размер укуса: откусывается рассчитанная часть, остаток отскакивает.

**Пример:**

Собиратель 200 кг с талантом Обжора (+20%) кусает пузырь 50 кг:
- Размер укуса: 200 × 10% × 1.25 = 25 кг
- Пузырь 50 кг > 25 кг → откусывается 25 кг
- Талант Обжора: 25 × 1.20 = 30 кг получено
- Остаток пузыря: 25 кг (отскакивает)

### 2.4. Укус слайма

**Параметры урона по зонам:**

| Параметр | Бок | Хвост |
|---|---:|---:|
| `biteVictimLossPct` | 20% | 30% |
| `biteAttackerGainPct` | 10% | 15% |
| `biteBubbleDropPct` | 10% | 15% |
| `biteTailDamageMul` | — | ×1.5 |

**Сводная таблица:**

| Зона попадания | Урон жертве | Атакующему | В пузыри |
|---|---:|---:|---:|
| Бок | `biteVictimLossPct` (20%) | `biteAttackerGainPct` (10%) | `biteBubbleDropPct` (10%) |
| Хвост | 30% (×1.5) | 15% (×1.5) | 15% (×1.5) |

Хвост = бок × `biteTailDamageMul`.

---

## 3. Столкновение пастью к пасти

### 3.1. Условие

Оба слайма направлены пастями друг на друга в момент столкновения.

### 3.2. Результат по разнице массы

| Разница массы | Результат |
|---|---|
| > 10% | Тяжёлый наносит урон лёгкому (20% массы лёгкого). Оба отскакивают по формуле импульса. |
| ≤ 10% | Оба отскакивают, урон никому. |

### 3.3. Формула импульса отскока

```
impulse = (1 + restitution) × reducedMass × relativeVelocity
```

Где:
- `restitution = 0.3` — коэффициент восстановления
- `reducedMass = (m1 × m2) / (m1 + m2)`
- `relativeVelocity` — относительная скорость сближения вдоль линии столкновения

---

## 4. Неуязвимость после урона

### 4.1. Параметры

| Параметр | Значение |
|---|---|
| Длительность `invulnAfterDamageSec` | 0.2 сек |

### 4.2. Блокирует

- Укусы слаймов
- Снаряды умений

### 4.3. Не блокирует

- Урон от зон (Лава)
- Отравление

### 4.4. Особенность

Все снаряды одного залпа (например, Плевок) считаются одним источником урона.

---

## 5. Эффект при гибели

### 5.1. Токсичная лужа

Остаётся на месте гибели слайма.

| Параметр | Значение |
|---|---|
| Радиус | 20 м |
| Длительность | 3 сек |
| Урон | 1% массы в секунду |
| Замедление | −20% к скорости |

Радиус лужи примерно в 3 раза больше радиуса погибшего слайма (50 кг ≈ 7 м).

### 5.2. Пузыри при гибели

**Параметры:**

| Параметр | Значение |
|---|---|
| `deathBubbleCountMin` | 6 |
| `deathBubbleCountMax` | 8 |

**Алгоритм распределения:**

1. Определить количество пузырей: случайное от 6 до 8.
2. Масса каждого пузыря = `остаток массы / количество` (равномерное распределение).
3. Цвет пузырей = цвет класса погибшего (Охотник → зелёный, Воин → красный, Собиратель → синий).
4. Если погибший был Королём, цвет = золотой.
5. Пузыри разлетаются на 360° со случайными углами.
6. Начальная скорость: 20–40 м/с.

---

## 6. Эффекты контроля

### 6.1. Оглушение

**Источник:** талант Молния.

| Параметр | Значение |
|---|---|
| Длительность | 0.3 сек |

**Запрещает:**
- Движение
- Поворот
- Активацию умений
- Укус

**Разрешает:**
- Получение урона (не даёт неуязвимости)

### 6.2. Замедление

**Источники:**
- Талант Мороз
- Зона Слизь
- Умение Замедление

**Эффект:** снижается максимальная скорость. Тяга двигателей не изменяется.

**Суммирование:** замедления от разных источников суммируются, но не более 80%.

### 6.3. Невидимость

**Источник:** талант Невидимка.

| Параметр | Значение |
|---|---|
| Длительность | 1.5 сек после Рывка |

**Эффект для врагов:**
- Слайм не отображается на экранах врагов
- Слайм не отображается на мини-карте
- Имя и контур скрыты
- Коллизии работают нормально

**Эффект для владельца:**
- Игрок видит своего слайма полупрозрачным (50% opacity)

**Досрочное снятие:**
- Укус другого слайма
- Активация любого умения
- Истечение времени

**Не снимает невидимость:**
- Поедание пузырей

---

## 7. Правила модификаторов

### 7.1. Типы модификаторов

**Урон:**
```
итоговый урон = базовый урон × (1 + Σ бонусов урона) × (1 − Σ штрафов урона)
```

**Получение массы:**
```
итоговая масса = базовая масса × (1 + Σ бонусов получения)
```

**Стоимость умений:**
```
итоговая стоимость = базовая стоимость × (1 − Σ скидок)
```
Минимум 1%.

**Скорость:**
```
итоговая скорость = базовая скорость × (1 + Σ бонусов) × (1 − Σ замедлений)
```

### 7.2. Пример расчёта урона

Охотник (−15% урон укусом) с талантом Острые зубы (+15%) атакует в бок:
- Базовый урон: 20% массы жертвы
- Бонусы: +15% (Острые зубы)
- Штрафы: −15% (класс)
- Итого: 20% × (1 + 0.15) × (1 − 0.15) = 20% × 1.15 × 0.85 = 19.55%

### 7.3. Пример расчёта получения массы

Собиратель (+25% к размеру укуса пузырей) с талантом Обжора (+20%) укусывает пузырь:
- Размер укуса: 200 кг × 10% × 1.25 = 25 кг
- Пузырь 30 кг > 25 кг → откусывается 25 кг
- Бонус Обжоры: 25 × 1.20 = 30 кг получено
- Остаток пузыря: 5 кг

### 7.4. Пример расчёта получения массы от убийства

Собиратель с талантом Кровожадность (+15% от убийств) убивает врага:
- Базовая масса от убийства: 100 кг
- Бонус Собирателя: не применяется (только для пузырей)
- Бонус Кровожадности: +15%
- Итого: 100 × (1 + 0.15) = 115 кг

---

## Связанные документы

- [GDD-Core.md](GDD-Core.md) — основные правила
- [GDD-Abilities.md](GDD-Abilities.md) — умения
- [GDD-Talents.md](GDD-Talents.md) — таланты
