# Slime Arena — План разработки

**Версия:** 3.3.0  
**Автор:** Claude Opus, Copilot  
**Дата:** декабрь 2025  

План разработки в соответствии с модульным пакетом GDD v3.3.  
Техническая архитектура — в `SlimeArena-Architecture-v3.3.md`.

---

## 0. Изменения версии 3.3.0

Синхронизация с модульным пакетом GDD v3.3:

- **Версия документа:** приведена к 3.3 для соответствия GDD.
- **Респаун-щит:** добавлена механика `respawnShieldSec=5` с правилами.
- **Таблица лидеров:** унифицирована на Top-10 везде.
- **GCD:** везде указано `gcdTicks=3` (100 мс при 30 Гц).
- **Карточки:** добавлена явная задача на систему очереди (таймер 12 сек, очередь 3).
- **Король:** добавлена задача на визуализацию (корона + золотое свечение).
- **Состояния комнаты:** добавлены задачи на переходы.

---

## 1. Источники правды

| Документ | Содержание |
|----------|------------|
| `GDD-Core.md` | Базовые правила, классы, масса, прогресс |
| `GDD-Combat.md` | Боевая система, урон, эффекты контроля |
| `GDD-Abilities.md` | Умения, слоты, улучшения |
| `GDD-Talents.md` | Таланты, редкости, карточки |
| `GDD-Chests.md` | Сундуки, обручи, усиления |
| `GDD-Arena.md` | Карты, зоны, препятствия |
| `GDD-UI.md` | Интерфейс, камера |
| `GDD-Glossary.md` | Глоссарий |
| `SlimeArena-Architecture-v3.3.md` | Архитектура |
| Этот документ | Этапы разработки |

---

## 2. Принципы (нельзя нарушать)

- **Матч не на паузе.** Выбор быстрый и безопасный.
- **Сервер авторитетный.** Клиент не решает урон/массу/столкновения.
- **Конфигурация через config.** Баланс без правок кода.
- **Простой запуск.** `docker compose up` и работает.
- **Оптимизация через ограничения.** Лимиты важнее сложной графики.

---

## 3. Этапы разработки

### 3.1. Прототип ядра (Core Prototype)

**Цель:** цикл «движение → пузырь → рост → столкновение → смерть/респаун → результат».

**Оценка:** 3–4 недели (1 fullstack)

**Зависимости:** нет

**Критический путь:**
- Room/матч-цикл (Colyseus) + старт/стоп матча
- Серверная симуляция 30 Гц
- Управление/движение: `FlightAssistSystem → PhysicsSystem → CollisionSystem`
- Интенты ввода → симуляция → снапшоты (10–20 Гц)
- U2-стиль сглаживания ✓ Выполнено
- Мини-экран результатов

| Задача | Оценка | Статус |
|--------|--------|--------|
| Colyseus room + tick loop (30 Гц) | 2 дня | ✓ |
| Состояния комнаты: Lobby → Running → Results | 1 день | ✓ |
| Конфиги `SlimeConfig/WorldPhysicsConfig` | 2 дня | ✓ |
| `FlightAssistSystem` | 3 дня | ✓ |
| `PhysicsSystem` (Semi-Implicit Euler) | 2 дня | ✓ |
| `CollisionSystem` (импульсы, итерации) | 3 дня | ✓ |
| Пузыри: спавн, цвет, плотность | 2 дня | ✓ |
| Укус: полное + частичное поглощение | 3 дня | ✓ |
| Бой: зоны пасть/хвост/бока + урон | 3 дня | ✓ |
| Смерть/респаун: 2 сек + респаун-щит 5 сек | 2 дня | ✓ |
| Клиент: Canvas рендер | 3 дня | ✓ |
| U2-стиль сглаживания | 3 дня | ✓ |
| Адаптивный джойстик | 3 дня | ✓ |
| Таймер + экран результатов (Top-10) | 2 дня | ✓ |

**Критерий готовности:**
- Матч 1v1 от старта до конца без падений.
- Предсказуемые отскоки и укус пузырей.
- Респаун и респаун-щит работают.

---

### 3.2. Gameplay MVP

**Цель:** базовый геймплей GDD v3.3 для плейтестов.

**Оценка:** 4–6 недель после прототипа

**Зависимости:** прототип ядра

#### 3.2.1. Классы и умения

| Задача | Оценка | Статус |
|--------|--------|--------|
| 3 класса (пассивы) | 2 дня | ✓ |
| Рывок (Охотник) | 2 дня | ✓ |
| Щит (Воин) | 2 дня | ✓ |
| Замедление (Собиратель) | 2 дня | ✓ |
| `gcdTicks=3` (100 мс при 30 Гц) + очередь (max 1) | 2 дня | ✓ |
| Слоты умений 2 и 3 | 2 дня | ✓ |
| Общий пул: Притяжение | 2 дня | ✓ |
| Общий пул: Выброс | 3 дня | ✓ |
| Общий пул: Плевок | 2 дня | ✓ |
| Общий пул: Бомба | 2 дня | ✓ |
| Общий пул: Отталкивание | 2 дня | ✓ |
| Общий пул: Мина | 3 дня | ✓ |
| Уровни умений 1–3 | 3 дня | ✓ |

#### 3.2.2. Сундуки и усиления

| Задача | Оценка | Статус |
|--------|--------|--------|
| Сундуки: спавн, физика, типы | 3 дня | ✓ |
| Обручи: механика ломания (учёт `gcdTicks=3`) | 2 дня | ✓ |
| Награда: талант + пузыри | 3 дня | ✓ |
| `BoostSystem`: базовая логика | 2 дня | ✓ |
| Усиления: Ярость | 1 день | ✓ |
| Усиления: Ускорение | 1 день | ✓ |
| Усиления: Защита | 1 день | ✓ |
| Усиления: Жадность | 1 день | ✓ |
| Визуализация усилений (слои, иконки) | 2 дня | ✓ |

#### 3.2.3. Арена

| Задача | Оценка | Статус |
|--------|--------|--------|
| Размеры карт (800/1200/1600) | 2 дня | ✓ |
| Генератор случайной арены | 4 дня | ✓ |
| Зона: Нектар | 1 день | ✓ |
| Зона: Лёд | 1 день | ✓ |
| Зона: Слизь | 1 день | ✓ |
| Зона: Лава | 1 день | ✓ |
| Зона: Турбо | 1 день | ✓ |
| Препятствие: Узкий проход (макс. 350 кг) | 2 дня | ✓ |
| Препятствие: Столб | 1 день | ✓ |
| Препятствие: Шипы | 1 день | ✓ |
| Безопасные зоны (финал): 1–3 по размеру карты | 3 дня | ✓ |

#### 3.2.4. Таланты и карточки

| Задача | Оценка | Статус |
|--------|--------|--------|
| `TalentSystem`: уровни 1–3 | 3 дня | ✓ |
| Карточки: формат 1 из 3 | 2 дня | ✓ |
| Карточки: очередь 3, таймер 12 сек | 2 дня | ✓ |
| Карточки: автовыбор по приоритету класса | 2 дня | ✓ |
| Карточки: сворачивание при уроне | 1 день | ✓ |
| Карточки: пауза таймера при респауне | 1 день | ✓ |
| Обычные таланты (16 шт.) | 5 дней | ✓ |
| Редкие таланты (10 шт.) | 4 дня | ✓ |
| Эпические таланты (5 шт.) | 3 дня | ✓ |
| Классовые таланты | 3 дня | ✓ |

#### 3.2.5. Боевка и контроль

| Задача | Оценка | Статус |
|--------|--------|--------|
| Столкновение пастями (разница 10%) | 2 дня | ✓ |
| Токсичная лужа при гибели | 2 дня | ✓ |
| Эффект: Оглушение (0.3 сек) | 1 день | ✓ |
| Эффект: Замедление (до 80%) | 1 день | ✓ |
| Эффект: Невидимость (1.5 сек) | 2 дня | ✓ |
| Пузыри при гибели по классу (6–8 шт.) | 1 день | ✓ |

#### 3.2.6. UI и камера

| Задача | Оценка | Статус |
|--------|--------|--------|
| HUD: масса/уровень/время | 2 дня | ✓ |
| HUD: кнопки умений + КД | 2 дня | ✓ |
| HUD: карточки выбора (правый край) | 3 дня | ✓ |
| Мини-карта: границы, видимая область | 2 дня | ✓ |
| Мини-карта: сундуки (глобально всем) | 1 день | ✓ |
| Мини-карта: Король (корона) | 1 день | ✓ |
| Мини-карта: безопасные зоны | 1 день | ✓ |
| Автомасштабирование камеры (формула) | 3 дня | ✓ |
| Индикатор усилений (иконки + таймеры) | 2 дня | ✓ |
| Индикатор респаун-щита (купол) | 1 день | ✓ |

#### 3.2.7. Система Короля

| Задача | Оценка | Статус |
|--------|--------|--------|
| Пересчёт лидера (мгновенный) | 1 день | ✓ |
| Визуальная метка: корона + золотое свечение | 2 дня | ✓ |
| Золотые пузыри при укусе Короля | 1 день | ✓ |
| Отображение на мини-карте | 1 день | ✓ |

#### 3.2.8. Экран результатов

| Задача | Оценка | Статус |
|--------|--------|--------|
| Таблица лидеров (Top-10) | 2 дня | ✓ |
| Личная статистика | 1 день | ✓ |
| Выбор класса перед следующим матчем | 1 день | ✓ |
| Таймер автостарта (`resultsDurationSec=12`) | 1 день | ✓ |

**Критерий готовности:**
- 10–20 игроков могут плейтестить FFA.
- `gcdTicks=3` (100 мс при 30 Гц) работает.
- Фазы дают нужный темп.
- Сундуки спорные, усиления работают.

**Метрики успеха:**
- Средняя длительность матча 2–3 минуты.
- Смертей на игрока: 1–3.
- Открытий сундуков: 3–6 за матч.

---

### 3.3. Публичный MVP (Product MVP)

**Цель:** первый релиз с минимальной продуктовой обвязкой.

**Оценка:** 4–6 недель после Gameplay MVP

**Зависимости:** Gameplay MVP + UI/UX дизайн

| Задача | Оценка |
|--------|--------|
| Лобби: главный экран + поиск матча | 4 дня |
| Гостевой вход (анонимный userId) | 2 дня |
| Профиль: экран + редактирование ника | 4 дня |
| Персистентность результатов | 5 дней |
| Рейтинг (Elo-like) + лиги | 4 дня |
| Таблица лидеров (Top-10) | 3 дня |
| Достижения (ядро) + 10–15 штук | 5 дней |
| Ежедневный бесплатный сундук | 4 дня |
| Rewarded Ads: ×2 награда | 4 дня |
| Магазин косметики (5–10 скинов) | 6 дней |
| Юмористические титулы | 2 дня |
| Модерация: репорты | 5 дней |

**Критерий готовности:**
- Игрок может: зайти → сыграть → получить награды → вернуться.
- Нет эксплойтов.

**Метрики успеха:**
- D1 Retention > 30%
- D7 Retention > 12–15%
- Сессия > 5 минут
- Конверсия ads > 20%

---

### 3.4. Альфа (расширение)

**Цель:** глубина и разнообразие.

**Оценка:** 4–8 недель после публичного MVP

| Функционал | Оценка |
|------------|--------|
| Командный режим 2v2/3v3 | 2–3 недели |
| Новые умения | 1–2 недели |
| Биомы карты | 1–2 недели |
| Улучшенный туториал | 1 неделя |

---

### 3.5. Бета (масштаб + сезонность)

**Цель:** подготовка к росту.

**Оценка:** 6–10 недель после Альфы

| Функционал | Оценка |
|------------|--------|
| Сезонный пропуск (30 уровней) | 2–3 недели |
| VIP-подписка | 1–2 недели |
| Нагрузочные тесты | 1–2 недели |
| Античит | 1 неделя |

---

## 4. Телеметрия

### 4.1. События матча

| Событие | Поля |
|---------|------|
| `match_start` | matchId, playerCount, mode, seed, mapSize |
| `match_end` | matchId, duration, winnerMass, avgMass, phase |
| `player_death` | matchId, playerId, killerId, mass, zone |
| `player_respawn` | matchId, playerId, shieldActive |
| `king_assigned` | matchId, kingId, mass |
| `chest_opened` | matchId, playerId, chestType, rewardType |
| `talent_chosen` | matchId, playerId, talentId, method, level |
| `card_auto_picked` | matchId, playerId, cardIndex |
| `ability_used` | matchId, playerId, abilityId, level |
| `boost_gained` | matchId, playerId, boostType |
| `zone_damage` | matchId, playerId, zoneType, damage |

### 4.2. События продукта

| Событие | Поля |
|---------|------|
| `daily_chest_claimed` | userId, rewardType, doubled |
| `ad_watched` | userId, adType, reward |
| `purchase` | userId, itemId, price |

---

## 5. Тестирование

### 5.1. Физика

| Тест | Критерий |
|------|----------|
| Столкновения | нет «взрыва» скорости |
| Плотность пузырей | золотые сложнее сдвигать |
| Сундуки физические | сундук отлетает при ударе |
| Зоны эффектов | корректное применение |

### 5.2. Механики

| Тест | Критерий |
|------|----------|
| `gcdTicks=3` + очередь | нельзя 2 умения в 1 тик |
| Обручи сундуков | укус ломает по одному |
| Усиления | корректная длительность |
| Безопасные зоны | урон вне зон в финале |
| Статус Короля | мгновенное переназначение |
| Респаун-щит | 5 сек, снимается атакой |

### 5.3. Управление

| Тест | Критерий |
|------|----------|
| Адаптивный джойстик | работает под палец |
| Карточки | сворачивание при уроне, таймер 12 сек |
| Камера | плавное масштабирование |

---

## 6. Definition of Done

- Код прошёл review.
- Тесты зелёные.
- Без критических багов.
- Документация актуальна.
- Идемпотентность наград.

---

## Приложение A. Конфигурация

Рекомендуемая структура:

- `config/slimes/*.json` — `SlimeConfig` (классы)
- `config/worlds/*.json` — `WorldPhysicsConfig` (карты)
- `config/abilities.json` — умения
- `config/talents.json` — таланты
- `config/chests.json` — сундуки, усиления
- `config/zones.json` — зоны эффектов
- `config/obstacles.json` — препятствия
- `config/match.json` — фазы, безопасные зоны, респаун

---

## Приложение B. Глоссарий

| Термин | Определение |
|--------|-------------|
| GCD | `gcdTicks=3` (100 мс при 30 Гц) |
| Король | Лидер по массе |
| Обруч | Слой защиты сундука |
| Усиление | Временный эффект из сундука |
| Безопасная зона | Область без урона в финале |
| Респаун-щит | Защита 5 сек после возрождения |
| Идемпотентность | Защита от двойных наград |
| Top-10 | Размер таблицы лидеров |
