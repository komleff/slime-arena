# Slime Arena v0.7.0 Release Notes

**Дата:** 29 января 2026
**Ветка:** `sprint-14/meta-integration`
**PR:** #111
**Статус:** ✅ Pre-release (готов к merge)

## Ревью-консенсус

| Ревьювер | Статус |
|----------|--------|
| Claude Opus 4.5 | ✅ APPROVED |
| GitHub Copilot | ✅ APPROVED |
| Gemini Code Assist | ✅ APPROVED |
| OpenAI Codex | ✅ APPROVED |

**Консенсус: 4/4 APPROVED**

---

## Обзор

Sprint 14 завершает P0 интеграцию клиента с MetaServer. Добавлена полноценная система авторизации (Guest + Telegram), экран результатов с наградами, и глобальная таблица лидеров.

---

## Новые возможности

### Meta Integration (Sprint 14)

- **Guest Auth Flow** — гостевая авторизация для Standalone-пользователей
  - `POST /auth/guest` → `guestToken`
  - Автоматическая генерация никнейма и скина
  - Сохранение в localStorage

- **Telegram Silent Auth** — бесшовная авторизация для Telegram Mini App
  - `POST /auth/telegram` с initData
  - Поддержка анонимных пользователей (`is_anonymous` флаг)

- **claimToken Flow** — токен для привязки результатов матча
  - `POST /match-results/claim` → `claimToken`
  - Используется в upgrade flow для конвертации гостя

- **RegistrationPromptModal** — модал сохранения прогресса
  - Показывается при `finalMass >= 200` для гостей/анонимов
  - Интеграция с Telegram upgrade flow

- **LeaderboardScreen** — глобальная таблица лидеров
  - Два режима: накопительный (total) / рекордный (best)
  - Топ-100 игроков
  - Позиция текущего игрока

- **ResultsScreen** — улучшенный экран результатов
  - Локальный расчёт наград (XP, coins, rating)
  - Интеграция с claimToken flow
  - Устойчивость к ошибкам meta-сервера

### Database & Infrastructure (Sprint 13)

- **Phase 1: Database**
  - PostgreSQL миграции (leaderboards, oauth_links, rating_awards)
  - Docker multi-platform build (ARM64 + AMD64)

- **Phase 2: API**
  - 13 API endpoints (auth/*, profile/*, matchmaking/*, leaderboard)
  - 11 сервисов (AuthService, RatingService, LeaderboardService)
  - JWT-авторизация с refresh tokens

### Tools & Automation

- **PM Orchestrator** — консенсусная система для код-ревью
  - Агрегация отзывов от Codex, Copilot, Gemini
  - Автоматическая классификация P0-P4

---

## Исправленные баги

| ID | Приоритет | Описание |
|----|-----------|----------|
| slime-arena-q90 | P0 | Math.random() → Rng в skinGenerator (детерминизм) |
| slime-arena-d0f | P2 | null protection в normalizeNickname |
| slime-arena-zwe | P2 | Расширен список banned words |
| slime-arena-0qa | P0 | Infinite logout loop на 401 |
| slime-arena-99u | P1 | CSS-градиенты (performance на mobile) |
| slime-arena-0ih | P1 | visual секция теряется в resolveBalanceConfig |

---

## Технические улучшения

- **Архитектура клиента**
  - `metaServerClient` с retry-логикой и 401 handling
  - Preact signals для состояния авторизации
  - UIBridge интеграция для всех модалов

- **Безопасность**
  - JWT access/refresh/guest/claim tokens
  - Защита от race condition в auth upgrade
  - Валидация joinToken в ArenaRoom

- **Качество кода**
  - 12+ итераций код-ревью (Opus, Codex, Copilot, Gemini)
  - Все P0/P1 замечания исправлены (15+ fixes)
  - TypeScript strict mode compliance

---

## Отложенные задачи (P2-P3)

| ID | Приоритет | Описание |
|----|-----------|----------|
| slime-arena-07o | P2 | REWARDS_CONFIG синхронизация с сервером |
| slime-arena-8e3 | P2 | Server returns place в personalStats |
| slime-arena-9tv | P3 | i18n инфраструктура и локализация UI |
| slime-arena-knf | P3 | fetchProfile после upgrade для синхронизации |
| slime-arena-0v2 | P2 | REWARDS_CONFIG → balance.json |
| slime-arena-isf | P2 | Server returns place in personalStats |

---

## Миграция с v0.6.0

Никаких breaking changes. Обновление:

```bash
git checkout main
git pull origin main
npm install
npm run build
```

---

## Известные ограничения

1. **OAuth** (Google/Yandex) не реализован — только Telegram
2. **Leaderboard** показывает пустой nickname для текущего игрока если не в топ-100
3. **claimToken** требует работающий meta-server для полного flow

---

## Статистика

- **Коммитов в PR#111:** 23
- **Файлов изменено:** 23 (+1976 / -57)
- **Итераций ревью:** 12+
- **Закрыто beads:** 6+ (Sprint 14)

---

## Благодарности

- Codex — код-ревью и архитектурные рекомендации
- Copilot — детальный анализ edge cases
- Gemini — проверка соответствия документации

---

**Релиз:** v0.7.0 pre-release — готов к merge в main
