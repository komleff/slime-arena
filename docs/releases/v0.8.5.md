# Slime Arena v0.8.5 — Admin Dashboard & Production Launch

> **Важнейший шаг к запуску:** операторы получили полноценную панель управления сервером без SSH.

## Что нового в v0.8.5

### Admin Dashboard (https://slime-arena.overmobile.space/admin/)

Полнофункциональная веб-панель для управления игровым сервером:

- **Dashboard** — метрики сервера в реальном времени (CPU, RAM, uptime, онлайн)
- **Rooms** — список активных игровых комнат
- **Audit** — журнал действий администраторов
- **Settings** — настройка 2FA, смена пароля
- **Restart** — перезапуск сервера с уведомлением игроков

### Перезапуск сервера из браузера

Администраторы могут перезапустить сервер одной кнопкой:

1. Админ нажимает "Restart" и подтверждает 2FA-кодом
2. Игроки видят баннер с обратным отсчётом (30 сек)
3. Watchdog выполняет `docker restart` и уведомляет в Telegram
4. Сервер поднимается автоматически (~10 сек)

### Watchdog-сервис

Новый systemd-сервис на хосте:
- Мониторинг здоровья каждые 30 секунд
- Автоматический перезапуск после 3 неудач health check
- Приём команд рестарта из Admin Dashboard (outbox-паттерн)
- Telegram-уведомления (опционально)

---

## Исправления v0.8.5

- Admin API: исправлен `API_BASE` с абсолютного на относительный (устранён ERR_SSL_PROTOCOL_ERROR)
- serve.json: убрано конфликтующее поле `"public"` (устранён 404)
- Nginx: trailing slash в `proxy_pass` для `/admin/`, `_-` в WebSocket regex
- 2FA: корректное отображение статуса в Settings
- Guest UI: улучшения интерфейса, обновлён favicon
- HUD: выравнивание ссылки входа для гостей

---

## История патчей: v0.7.8 → v0.8.5

### v0.8.4 — Split Architecture (7 февраля)

Переход с монолита на split-архитектуру:
- **Два контейнера:** `slime-arena-db` (PostgreSQL + Redis) + `slime-arena-app` (все сервисы)
- **docker-compose** вместо `docker run`
- Обновление app за ~5 секунд без потери данных
- Монолит `monolith-full` помечен как deprecated

### v0.8.3 — Infrastructure & Auth UX (7 февраля)

- Кнопка «Войти» для гостей в лобби
- RestartPage в Admin Dashboard (с 2FA подтверждением)
- Скрипт удалённого бэкапа PostgreSQL
- Протокол бэкапов (P0: pg_dump обязателен перед обновлением)

### v0.8.2 — Admin Dashboard Phase 2 (5 февраля)

Полноценная панель администратора:
- DashboardPage — метрики сервера с real-time polling
- RoomsPage — активные комнаты
- AuditPage — журнал действий
- POST /api/v1/admin/restart — перезапуск с 2FA
- GET /api/v1/admin/stats — метрики для дашборда
- watchdog.py — мониторинг на хосте

### v0.8.0 — Admin Dashboard Phase 1 (4 февраля)

Первый релиз Admin Dashboard:
- JWT-аутентификация с HttpOnly cookie
- 2FA (TOTP) с AES-256-GCM шифрованием
- Rate limiting: 5 req/min для admin login
- Preact SPA с login и Settings
- Миграции: admin_users, admin_sessions, audit_log

### v0.7.8 — Reverse Proxy Support (2 февраля)

- Поддержка Nginx reverse proxy
- Корректное определение URL мета-сервера

---

## Статистика

| Метрика | Значение |
| ------- | -------- |
| Коммитов (v0.7.8 → v0.8.5) | 30 |
| Pull Requests | 14 |
| Новые файлы | 40+ |
| Новые строки кода | ~8000 |

## Инфраструктура

| Компонент | Описание |
| --------- | -------- |
| `slime-arena-db:0.8.5` | PostgreSQL 16 + Redis |
| `slime-arena-app:0.8.5` | MetaServer + MatchServer + Client + Admin |
| Nginx | Reverse proxy + SSL (Let's Encrypt) |
| Watchdog | systemd health monitor + restart handler |
| Бэкапы | Cron каждые 6 часов, ротация 7 дней |

## Обновление

```bash
cd /root/slime-arena
docker compose pull app
docker compose up -d app
docker exec slime-arena-app npm run db:migrate --workspace=server
```

Подробнее: [SERVER_UPDATE.md](docs/operations/SERVER_UPDATE.md)

---

**Full Changelog:** v0.7.8...v0.8.5
