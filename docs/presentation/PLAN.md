# Доклад: AI-Driven Game Development
## Методология и инструментарий разработки с AI-агентами

**Версия:** 2.0
**Дата презентации:** 24 января 2026
**Автор:** Дмитрий Комлев (гейм-дизайнер, продакт-менеджер)
**Проект:** Slime Arena — мобильная PvP-игра

---

## Ключевые цифры (актуальные на 21 января 2026)

| Метрика | Значение |
|---------|----------|
| **Период разработки** | 31 день (20 дек — 20 янв) |
| **Коммиты** | 473 (15.3 в день) |
| **Pull Requests** | 77 смержено |
| **Релизы** | 16 (v0.1.0 → v0.6.0) |
| **Код** | 83,050 строк (TypeScript) |
| **Документация** | 114 файлов Markdown |
| **Задачи (Beads)** | 80 (39 закрыто, 41 открыта) |

### Оценка объёма работ (человеко-дни)

**Традиционная команда:**

| Роль | Задачи | Человеко-дни |
|------|--------|:------------:|
| Backend-разработчик | Серверная логика, Colyseus, Schema | 40-60 |
| Frontend-разработчик | Клиент, Canvas 2D, Preact UI | 40-60 |
| Гейм-дизайнер | GDD (8 модулей), баланс, механики | 20-40 |
| Архитектор | Техдокументация, ревью, планирование | 20 |
| Менеджер | ТЗ, координация, roadmap | 20 |
| Тех. писатель | Документация (114 файлов) | 20 |
| **Итого** | | **160-220** |

**AI-driven (1 человек + агенты):**
- Фактически затрачено: **~25 человеко-дней**
- Среднее ускорение: **6-9x**

**Оптимизация ассетов:** 73 MB → 1.9 MB (96% сжатие)

---

## Часть 1: Контекст эксперимента

### 1.1 Вызов

**Гипотеза:** Нетехнический специалист (гейм-дизайнер) может создать production-ready игру, используя AI-агентов для всего технического стека.

**Роль автора:**
- Гейм-дизайнер по профессии
- В проекте: Product Manager + частично Project Manager
- **Не пишу код** — только формулирую требования и проверяю результат

### 1.2 Масштаб проекта

**Slime Arena:**
- Мобильная PvP-игра (Telegram Mini App, Яндекс.Игры)
- Реалтайм мультиплеер (30 tick/s, Colyseus)
- Детерминированная симуляция
- Полный игровой цикл: Лобби → Матч → Результаты

---

## Часть 1.5: Настройка среды и агентов

### 1.5.1 Среда разработки

| Инструмент | Назначение | Почему выбран |
|------------|------------|---------------|
| **VS Code** | Редактор | Бесплатный, расширения для AI |
| **Cursor** | AI-first редактор | Claude/GPT встроены |
| **Claude Code** | CLI для Claude | Прямой доступ к Opus |

### 1.5.2 Ключевые файлы конфигурации

```
project/
├── CLAUDE.md              ← Главные правила для агентов
├── .beads/
│   └── AGENT_ROLES.md     ← Инструкции по ролям
├── .memory_bank/
│   ├── activeContext.md   ← Что делаем сейчас
│   └── techContext.md     ← Технический стек
└── docs/
    └── architecture.md    ← Архитектура проекта
```

### 1.5.3 Architect как управляющий агент

**Ключевой инсайт Sprint 12:** Выделить одного агента для управления другими.

```
┌─────────────────────────────────────────────────────┐
│                    ARCHITECT                         │
│            (Claude Opus 4.5)                        │
│                                                     │
│  - Читает документацию                              │
│  - Составляет промпты для Developer                 │
│  - Координирует работу                              │
│  - НЕ пишет код                                     │
└───────────────────┬─────────────────────────────────┘
                    │ промпты
        ┌───────────┼───────────┐
        │           │           │
   ┌────▼────┐ ┌────▼────┐ ┌────▼────┐
   │Developer│ │Developer│ │Reviewer │
   │ (Opus)  │ │ (Opus)  │ │(Gemini) │
   └─────────┘ └─────────┘ └─────────┘
```

**Почему это работает:**
- Architect понимает контекст проекта целиком
- Developer получает готовый промпт с файлами и ограничениями
- Reviewer — другая модель (избегаем слепых пятен)

### 1.5.4 Шаблон CLAUDE.md

```markdown
# [Название] — инструкции для Claude

## Главные правила
1. Работай по задачам (Beads / Issues)
2. Пуш в main запрещён — только PR
3. После изменений: npm run build && npm run test

## Критичные ограничения
- [Ограничение 1 — например, детерминизм]
- [Ограничение 2 — например, баланс в конфиге]

## Ключевые файлы
| Файл | Назначение |
|------|------------|
| config/balance.json | Параметры баланса |
| server/src/rooms/ArenaRoom.ts | Игровая логика |
```

### 1.5.5 Промпт для Architect

```
Ты — Architect проекта [название].

Твоя задача: [описание от пользователя]

Контекст:
- Прочитай: CLAUDE.md, .memory_bank/activeContext.md
- Архитектура: docs/architecture.md

Действия:
1. Разбей задачу на подзадачи для Developer
2. Для каждой подзадачи составь промпт:
   - Что сделать
   - Какие файлы изменить
   - Какие ограничения соблюдать
   - Критерии готовности

Формат:
### Подзадача 1: [название]
Промпт для Developer:
[текст промпта]
Файлы: [список]
```

---

## Часть 2: Пять столпов методологии

### 2.1 Документация как контракт

**Проблема:** AI-агенты не помнят контекст между сессиями.

**Решение:** Исчерпывающая документация = источник истины

| Документ | Назначение |
|----------|------------|
| GDD (8 модулей) | Правила игры, баланс, механики |
| Architecture v4.2.5 | Техническая архитектура |
| TZ-SoftLaunch | Технические задания |
| AGENT_ROLES.md | Роли и ограничения агентов |

**Принцип:** Агент читает документ → выполняет задачу → результат проверяется по документу.

### 2.2 Zero Trust методология

**Проблема:** AI может галлюцинировать, писать нерабочий код, нарушать архитектуру.

**Решение:** Не доверять — проверять.

```
┌─────────────────────────────────────────┐
│  Задача → Код → Build → Test → Review   │
│     ↑                              │    │
│     └──────── Не прошло? ←─────────┘    │
└─────────────────────────────────────────┘
```

**Правила:**
- Каждый PR проходит CI (build + tests)
- Мультивендорное ревью (ChatGPT, Gemini, Copilot, Opus)
- Детерминизм-тесты обязательны (для игровой симуляции)
- Запрет push в main — только через PR

### 2.3 Memory Bank — скользящее окно контекста

**Проблема:** Контекст теряется при:
- Новой сессии
- Compaction (сжатие истории)
- Смене агента

**Решение:** `.memory_bank/` — внешняя память проекта

```
.memory_bank/
├── activeContext.md      ← Что сейчас делаем
├── techContext.md        ← Технический стек
├── productContext.md     ← Продуктовый контекст
├── progress.md           ← История изменений
└── systemPatterns.md     ← Архитектурные паттерны
```

**Протокол:** Агент начинает сессию с `bd prime` → читает Memory Bank → продолжает работу.

### 2.4 Beads — таск-менеджер для агентов

**Проблема:** Jira/Linear/Notion слишком тяжелы для агентов.

**Решение:** Beads — Git-native issue tracker

```bash
bd ready              # Показать готовые задачи
bd show <id>          # Детали задачи
bd update <id>        # Обновить статус
bd close <id>         # Закрыть
```

**Преимущества:**
- Данные в `.beads/` — часть репозитория
- Daemon автоматически синхронизирует
- Зависимости между задачами
- CLI-first — агенты работают напрямую

### 2.5 Разделение ролей агентов

**Проблема:** Один агент не может быть экспертом во всём.

**Решение:** 5 специализированных ролей

| Роль | Ответственность | Ограничения |
|------|-----------------|-------------|
| **Architect** | Планирование, координация | Не пишет код |
| **Developer** | Реализация по ТЗ | Только своя ветка |
| **Reviewer** | Code review | Не мержит |
| **QA** | Тестирование | Не исправляет |
| **Art Director** | Визуальный стиль | Не редактирует код |

**Результат Sprint 12:**
- 1 Architect (Claude Opus)
- 2 Developer (Opus) — параллельно через Git Worktrees
- 4-6 Reviewer (ChatGPT, Gemini, Copilot, Opus)

---

## Часть 3: Технические достижения

### 3.1 Архитектура

```
┌─────────────────────────────────────────────────────┐
│                    Client                           │
│  Vite + Canvas 2D + Preact                         │
│  InputManager → SmoothingSystem → Renderer         │
└─────────────────────┬───────────────────────────────┘
                      │ WebSocket
┌─────────────────────┴───────────────────────────────┐
│                    Server                           │
│  Colyseus (30 tick/s)                              │
│  ArenaRoom → Systems (Combat, Ability, Physics)    │
└─────────────────────┬───────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────┐
│              Meta Server + DB                       │
│  PostgreSQL + Redis                                │
└─────────────────────────────────────────────────────┘
```

### 3.2 Декомпозиция God Objects (Sprint 12)

**До:**
- ArenaRoom.ts: 3749 строк
- main.ts: 4109 строк

**После:**
- ArenaRoom.ts: 2704 строк (−28%)
- main.ts: 3790 строк (−8%)
- 8 новых модулей, 2043 строки извлечено

### 3.3 Детерминизм

**Требование:** Одинаковые inputs → одинаковый результат.

**Реализация:**
- Seeded RNG (`Rng` класс)
- Фиксированный порядок систем в `onTick()`
- Тесты детерминизма в CI

---

## Часть 4: Ошибки, грабли и уроки

### 4.1 Топ-10 реальных проблем

| # | Проблема | Что произошло | Как решили |
|---|----------|---------------|------------|
| 1 | **Коммит в main** | Агент запушил напрямую в main, минуя PR | GitHub branch protection rules |
| 2 | **Коммит в чужую ветку** | Агент 1 закоммитил CombatSystem в ветку Агента 2 | `git cherry-pick` + `git reset` |
| 3 | **Force push заблокирован** | Попытка откатить main через `--force` | GitHub rules защитили, пришлось принять |
| 4 | **Забыл создать ветку** | Агент начал работу, не проверив `git branch` | Pre-flight чеклист в промпте |
| 5 | **Worktree confusion** | Агент работал не в том worktree | Явная проверка `pwd` в начале |
| 6 | **Галлюцинации API** | Агент вызывал несуществующие методы Colyseus | Обязательный `npm run build` |
| 7 | **Детерминизм сломан** | Использовал `Math.random()` вместо `Rng` | Тесты детерминизма в CI |
| 8 | **Context overflow** | Файл 4000+ строк не помещался в контекст | Декомпозиция God Objects |
| 9 | **Забыл инструкции** | Агент mid-session перестал следовать CLAUDE.md | Memory Bank + повторение в промпте |
| 10 | **Hardcoded constants** | Агент написал `const SPEED = 100` вместо `balance.speed` | Code review + CLAUDE.md правила |

### 4.2 Типичные грабли по категориям

**Git-грабли:**
```
❌ git push origin main          → Прямой пуш в main
❌ git commit без проверки ветки → Коммит в чужую ветку
❌ git reset --hard             → Потеря работы
❌ Забыл git pull               → Merge conflicts
```

**Код-грабли:**
```
❌ Math.random()                → Сломан детерминизм
❌ Date.now() в симуляции       → Разная физика на клиентах
❌ Hardcoded числа              → Невозможно балансировать
❌ console.log в production     → Утечка памяти на мобильных
```

**Архитектурные грабли:**
```
❌ Изменил порядок систем в onTick() → Другое поведение игры
❌ Добавил поле в Player без Schema  → Не синхронизируется
❌ CSS-градиент в анимации           → Лаги на мобильных
```

### 4.3 Нерешённые проблемы

| Проблема | Статус | Почему не решено |
|----------|--------|------------------|
| Копипаст промптов между агентами | ❌ | Нет автоматизации |
| Синхронизация контекста | 🟡 | Memory Bank помогает на 80% |
| Агент забывает инструкции | ❌ | Ограничение context window |
| Автоматический пайплайн | ❌ | Требует custom tooling |
| Мультиагентная оркестрация | ❌ | Ручной контроль через VS Code |

### 4.4 Уроки на будущее

1. **Всегда branch protection** — даже для solo-проекта
2. **Pre-flight чеклист** — агент проверяет ветку ДО работы
3. **Тесты в CI** — детерминизм, типы, сборка
4. **Memory Bank** — обновлять при каждом значимом изменении
5. **Мультивендорное ревью** — один агент может пропустить ошибку

---

## Часть 5: Case Study — Sprint 12 (20 января 2026)

### 5.1 Задача

**Проблема:** God Objects — файлы по 4000+ строк
- `ArenaRoom.ts`: 3749 LOC (серверная логика)
- `main.ts`: 4109 LOC (клиент)

**Цель:** Декомпозиция в модули без регрессий

### 5.2 Организация работы

```
Архитектор (Opus 4.5)
    │
    ├── Агент 1 (worktree ar1) → server/
    │   └── CombatSystem, AbilityActivation, ArenaGenerator, PlayerStateManager
    │
    └── Агент 2 (worktree mt1) → client/
        └── RenderingSystem, GameLoopManager, VisualEffects, SmoothingSystem
```

**Инструменты:**
- Git Worktrees для изоляции
- Beads для трекинга задач
- 4-6 ревьюеров (ChatGPT, Gemini, Copilot, Opus)

### 5.3 Результаты за 4 часа

| Метрика | До | После | Изменение |
|---------|-----|-------|-----------|
| ArenaRoom.ts | 3749 LOC | 2704 LOC | −28% |
| main.ts | 4109 LOC | 3790 LOC | −8% |
| Новые модули | 0 | 8 | +8 файлов |
| Извлечено кода | — | 2043 LOC | — |

**8 новых модулей:**
1. `combatSystem.ts` (413 LOC)
2. `abilityActivationSystem.ts` (599 LOC)
3. `arenaGenerator.ts` (76 LOC)
4. `playerStateManager.ts` (181 LOC)
5. `draw.ts` (88 LOC)
6. `GameLoopManager.ts` (144 LOC)
7. `VisualEffects.ts` (204 LOC)
8. `SmoothingSystem.ts` (338 LOC)

### 5.4 Почему это успех

1. **Параллельная работа** — 2 агента, разные домены, 0 конфликтов
2. **Zero regressions** — все 3 теста прошли
3. **Скорость** — работа на 2-3 недели за 4 часа
4. **Качество** — код прошёл мультивендорное ревью

### 5.5 Пиковая производительность

**Sprint 12 — образцовый пример применения методологии:**
- **8 AI-агентов** (2 Developer + 4-6 Reviewer)
- **4 часа** работы
- **Результат:** 2043 LOC извлечено в 8 модулей
- **Традиционная оценка:** 2-3 недели (10-15 человеко-дней)
- **Ускорение:** 30-40x

### 5.6 Формула успеха

```
Чёткий план + Изолированные worktrees + Pre-flight чеклист + CI тесты
    = Параллельная работа без конфликтов
```

---

## Часть 6: Архитектура синхронизации

### 6.1 Проблема реалтайма

**Задача:** Синхронизировать состояние 10+ игроков при 30 tick/s с минимальной задержкой.

**Ограничения:**
- Сетевая задержка: 50-200ms
- Мобильный интернет: пакеты теряются
- Частота рендера: 60 FPS

### 6.2 Архитектура решения

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLIENT                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Input (Joystick)                                               │
│       │                                                         │
│       ▼                                                         │
│  ┌─────────────┐    ┌─────────────────┐    ┌───────────────┐   │
│  │ InputManager│───>│ SmoothingSystem │───>│   Renderer    │   │
│  └─────────────┘    └─────────────────┘    └───────────────┘   │
│       │                    ▲                                    │
│       │ input packet       │ snapshots                          │
│       ▼                    │                                    │
└───────┼────────────────────┼────────────────────────────────────┘
        │                    │
        │ WebSocket          │ State delta (Colyseus Schema)
        ▼                    │
┌───────┴────────────────────┴────────────────────────────────────┐
│                         SERVER                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    ArenaRoom                             │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐  │   │
│  │  │  Input   │─>│ Physics  │─>│ Combat   │─>│  State  │  │   │
│  │  │ Process  │  │ System   │  │ System   │  │  Sync   │  │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └─────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              GameState (Colyseus Schema)                 │   │
│  │  players[], orbs[], projectiles[], tick, phase...        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.3 Три ключевых компонента

**1. Сервер — источник истины**
```
Клиент НЕ отправляет: позиции, урон, массу
Клиент ТОЛЬКО отправляет: { moveX, moveY, abilitySlot }
```

**2. SmoothingSystem — интерполяция**
```typescript
// Буфер снапшотов (100ms истории)
snapshots: [state_t-3, state_t-2, state_t-1, state_t]

// Интерполяция между снапшотами
renderPosition = lerp(snapshot[i-1], snapshot[i], alpha)
```

**3. Детерминизм — предсказуемость**
```typescript
// Порядок систем ФИКСИРОВАН
onTick() {
  preprocessInputs()  // 1. Ввод
  physicsSystem()     // 2. Движение
  collisionSystem()   // 3. Столкновения
  abilitySystem()     // 4. Умения
  deathSystem()       // 5. Смерть
  orbSystem()         // 6. Орбы
  updatePhase()       // 7. Фазы матча
}
```

### 6.4 Масштабируемость

**Текущие лимиты (Colyseus + 30 tick/s):**

| Параметр | Значение | Примечание |
|----------|----------|------------|
| Игроков в комнате | 50-100 | Зависит от сложности симуляции |
| Tick rate | 30 Hz | Баланс между точностью и нагрузкой |
| Состояние игрока | ~200 байт | Colyseus Schema, дельта-сжатие |
| Пропускная способность | ~6 KB/s на клиента | При 30 tick/s |

**Горизонтальное масштабирование:**

```
                    ┌─────────────┐
                    │  MetaServer │
                    │  (координатор)│
                    └──────┬──────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
     ┌─────▼─────┐   ┌─────▼─────┐   ┌─────▼─────┐
     │MatchServer│   │MatchServer│   │MatchServer│
     │  (Арена 1)│   │  (Арена 2)│   │  (Арена N)│
     └───────────┘   └───────────┘   └───────────┘
```

**Архитектура поддерживает:**
- Несколько MatchServer под управлением одного MetaServer
- Redis для координации между инстансами
- Load balancing через MetaServer
- Динамическое создание комнат по нагрузке

**Цель:** 100 игроков в одной сессии (как у конкурентов) — достижимо при оптимизации симуляции.

### 6.5 Результат

- **Плавность:** 60 FPS на мобильных
- **Отзывчивость:** ввод обрабатывается мгновенно
- **Честность:** сервер гарантирует одинаковую физику для всех
- **Стабильность:** потеря пакетов не ломает игру

---

## Часть 7: Выводы

### 7.1 Что работает

| Практика | Эффект | Сложность внедрения |
|----------|--------|---------------------|
| **Документация как контракт** | Агенты следуют спецификациям | Высокая (нужно писать) |
| **Zero Trust** | 0 критических багов в production | Средняя (CI/CD) |
| **Memory Bank** | 80% сохранение контекста | Низкая (5 файлов) |
| **Разделение ролей** | Меньше ошибок, лучше код | Средняя (дисциплина) |
| **Git Worktrees** | Параллельная работа агентов | Низкая (команды git) |

### 7.2 Главный вывод

```
┌─────────────────────────────────────────────────────────────────┐
│  НЕТЕХНИЧЕСКИЙ СПЕЦИАЛИСТ может создать production-ready       │
│  техническое решение с AI-агентами ПРИ УСЛОВИИ:                │
│                                                                 │
│  ✓ Исчерпывающей документации требований                       │
│  ✓ Строгой методологии проверки (Zero Trust)                   │
│  ✓ Правильных инструментов (Beads, Memory Bank)                │
│  ✓ Разделения ролей и ответственности                          │
└─────────────────────────────────────────────────────────────────┘
```

### 7.3 Формула ускорения

```
Традиционная разработка:  1 разработчик × 2-3 недели = 1 Sprint 12
AI-driven разработка:     2 агента × 4 часа = 1 Sprint 12

Ускорение: 30-40x
```

**Но!** Это работает только при:
- Подготовленной инфраструктуре (документация, CI/CD, Memory Bank)
- Чётко изолированных задачах (разные домены файлов)
- Постоянном контроле человека-оператора

### 7.4 Roadmap

| Задача | Приоритет | Сложность |
|--------|-----------|-----------|
| Автоматическая оркестрация агентов | P1 | Высокая |
| Пайплайн: Task → Agent → Review → Merge | P1 | Средняя |
| Интеграция Memory Bank в агентов | P2 | Низкая |
| Метрики качества работы агентов | P2 | Средняя |
| Копирование контекста между агентами | P1 | Высокая |

---

## Q&A

### Частые вопросы

**Q: Нужно ли уметь программировать?**
A: Нет, но нужно понимать архитектуру и уметь читать код для ревью.

**Q: Какая модель лучше?**
A: Claude Opus 4.5 для архитектуры и сложных задач. Haiku для простых. Мультивендор для ревью.

**Q: Сколько стоит?**
A: ~$50-100/месяц при активной разработке (Claude API + ChatGPT Plus + Copilot).

**Q: Можно ли доверять AI-сгенерированному коду?**
A: Нет. Zero Trust: build → test → review → merge. Всегда.

---

**Контакты:**
- GitHub: komleff/slime-arena
- Проект: Slime Arena v0.6.0
- Презентация: 24 января 2026
