# Роли AI-агентов: Быстрый старт

Минимальная инструкция для начала работы с AI-агентами.

---

## Ключевой принцип: Один Architect управляет всеми

```
┌─────────────────────────────────────────────────────┐
│                    ARCHITECT                         │
│            (Claude Opus / GPT-4 / Gemini)           │
│                                                     │
│  - Читает документацию и требования                 │
│  - Составляет промпты для других агентов            │
│  - Координирует работу                              │
│  - НЕ пишет код сам                                 │
└───────────────────┬─────────────────────────────────┘
                    │
        ┌───────────┼───────────┐
        │           │           │
   ┌────▼────┐ ┌────▼────┐ ┌────▼────┐
   │Developer│ │Developer│ │Reviewer │
   │ (Opus)  │ │ (Opus)  │ │(Gemini) │
   └─────────┘ └─────────┘ └─────────┘
```

---

## 3 роли (минимум для старта)

### 1. Architect (Архитектор)

**Кто:** Claude Opus 4.5 / GPT-4o / Gemini Pro

**Что делает:**
- Читает GDD, ТЗ, архитектуру
- Разбивает задачи на подзадачи
- Составляет промпты для Developer
- Проверяет соответствие результата требованиям

**Не делает:** Не пишет код.

**Промпт для Architect:**
```
Ты — Architect проекта [название].

Твоя задача: [описание]

Контекст:
- Архитектура: [файл]
- GDD: [файл]
- Текущее состояние: [файл]

Действия:
1. Изучи документацию
2. Разбей задачу на подзадачи для Developer
3. Составь промпт для каждой подзадачи
4. Укажи файлы, которые нужно изменить

Формат вывода:
- Подзадача 1: [описание]
  Промпт для Developer: [текст]
  Файлы: [список]
```

### 2. Developer (Разработчик)

**Кто:** Claude Opus / Sonnet / Cursor

**Что делает:**
- Получает промпт от Architect
- Пишет код в своей ветке
- Запускает build и tests
- Создаёт PR

**Не делает:** Не мержит в main.

**Промпт для Developer:**
```
Ты — Developer проекта [название].

Твоя задача: [от Architect]

Правила:
- Работай только в ветке: [название]
- Файлы для изменения: [список]
- После изменений: npm run build && npm run test

Ограничения:
- [специфичные для проекта]

Формат работы:
1. Проверь git branch
2. Внеси изменения
3. Запусти тесты
4. Создай коммит
5. Создай PR (без merge!)
```

### 3. Reviewer (Ревьюер)

**Кто:** ChatGPT / Gemini / Copilot (другая модель!)

**Что делает:**
- Проверяет код в PR
- Запускает тесты
- Публикует отчёт в PR
- Даёт вердикт: APPROVED / CHANGES_REQUESTED

**Не делает:** Не исправляет код.

**Промпт для Reviewer:**
```
Ты — Reviewer проекта [название].

Проверь PR: [ссылка или diff]

Чеклист:
- [ ] Код компилируется (npm run build)
- [ ] Тесты проходят (npm run test)
- [ ] Нет hardcoded констант
- [ ] Соответствует требованиям

Формат отчёта:
## Review by [твоя модель]

### Чеклист
- [x/] Пункт 1
- [x/] Пункт 2

### Замечания
1. [P1] файл:строка — описание
2. [P2] файл:строка — описание

### Вердикт
APPROVED / CHANGES_REQUESTED
```

---

## Настройка среды

### VS Code / Cursor

**Расширения:**
- Claude Dev / Continue (для Claude API)
- GitHub Copilot (опционально)

**Файл настроек: `.vscode/settings.json`**
```json
{
  "claude.apiKey": "${env:ANTHROPIC_API_KEY}",
  "claude.model": "claude-opus-4-5-20251101"
}
```

### Файлы конфигурации проекта

```
project/
├── CLAUDE.md              ← Главные правила для агентов
├── .beads/
│   └── AGENT_ROLES.md     ← Полные инструкции по ролям
├── .memory_bank/
│   ├── activeContext.md   ← Текущее состояние
│   └── techContext.md     ← Технический стек
└── docs/
    └── architecture.md    ← Архитектура проекта
```

### CLAUDE.md (минимальный шаблон)

```markdown
# [Название проекта] — инструкции для Claude

## Главные правила
1. Работай по задачам (Beads / GitHub Issues)
2. Пуш в main запрещён — только через PR
3. После изменений: npm run build && npm run test

## Архитектура
- [Краткое описание]
- Клиент: [технологии]
- Сервер: [технологии]

## Критичные ограничения
- [Ограничение 1]
- [Ограничение 2]

## Ключевые файлы
| Файл | Назначение |
|------|------------|
| [путь] | [описание] |
```

---

## Workflow на практике

### Шаг 1: Architect получает задачу

```
Пользователь → Architect:
"Добавь авторизацию через JWT"
```

### Шаг 2: Architect анализирует и составляет промпт

```
Architect анализирует:
- docs/architecture.md
- server/src/auth/ (если есть)
- Существующие паттерны

Architect создаёт промпт для Developer:
"Создай JWT авторизацию:
1. Файл: server/src/auth/jwt.ts
2. Методы: generateToken(), verifyToken()
3. Использовать: jsonwebtoken из package.json
4. Тесты: server/tests/auth/jwt.test.ts"
```

### Шаг 3: Developer выполняет

```bash
# Developer создаёт ветку
git checkout -b feature/jwt-auth

# Пишет код по промпту
# ...

# Проверяет
npm run build
npm run test

# Создаёт PR
git push -u origin feature/jwt-auth
gh pr create --title "feat: JWT authentication"
```

### Шаг 4: Reviewer проверяет

```
Reviewer получает PR, проверяет по чеклисту,
публикует отчёт в PR:

## Review by Gemini 2.5 Pro

### Чеклист
- [x] Код компилируется
- [x] Тесты проходят
- [ ] Нет hardcoded секретов

### Замечания
1. [P1] jwt.ts:15 — JWT_SECRET захардкожен

### Вердикт
CHANGES_REQUESTED
```

### Шаг 5: Developer исправляет, Reviewer одобряет

### Шаг 6: Человек мержит PR

---

## Чеклист для каждой роли

### Architect (перед составлением промпта)

```
[ ] Прочитал документацию проекта
[ ] Понял текущее состояние (Memory Bank)
[ ] Определил файлы для изменения
[ ] Указал ограничения в промпте
[ ] Указал критерии готовности
```

### Developer (перед коммитом)

```
[ ] Проверил git branch (правильная ветка?)
[ ] npm run build проходит
[ ] npm run test проходит
[ ] Нет hardcoded констант
[ ] Коммит создан, PR открыт
```

### Reviewer (перед вердиктом)

```
[ ] Запустил build и tests
[ ] Проверил соответствие требованиям
[ ] Указал приоритеты замечаний (P0-P3)
[ ] Дал чёткий вердикт (не "наверное ОК")
```

---

## Типичные ошибки

| Ошибка | Почему плохо | Как избежать |
|--------|--------------|--------------|
| Агент пушит в main | Ломает историю | Branch protection в GitHub |
| Агент не проверяет ветку | Коммит в чужую ветку | Pre-flight чеклист |
| Один агент на всё | Пропускает ошибки | Разные модели для ревью |
| Нет документации | Агент галлюцинирует | CLAUDE.md + Memory Bank |
| Забыл тесты | Регрессии | npm run test в чеклисте |

---

## Параллельная работа (Git Worktrees)

Для 2+ агентов одновременно:

```bash
# Создать изолированные рабочие директории
git worktree add ../project-agent1 -b feature/task1
git worktree add ../project-agent2 -b feature/task2

# Агент 1 работает в ../project-agent1
# Агент 2 работает в ../project-agent2
# Конфликтов нет — разные ветки и директории

# После завершения — удалить worktrees
git worktree remove ../project-agent1
git worktree remove ../project-agent2
```

---

## Стоимость

| Сервис | Роль | Цена/мес |
|--------|------|----------|
| Claude API (Opus) | Architect, Developer | $20-50 |
| ChatGPT Plus | Reviewer | $20 |
| Gemini Pro | Reviewer | Бесплатно |
| Copilot | Developer | $10-19 |
| **Итого** | | **$50-100** |

---

## Ссылки

**Статьи (рекомендуемое чтение):**

- [Habr: Vibe Coding — как я перестал бояться и полюбил AI](https://habr.com/ru/articles/979624/) — ключевая статья о методологии
- [Habr: AI-агенты в разработке](https://habr.com/ru/articles/964368/)
- [Habr: Memory Bank и управление контекстом](https://habr.com/ru/articles/983498/) — важнейшая статья о сохранении контекста

**Инструменты:**

- [Claude Code](https://claude.ai/claude-code) — CLI для Claude
- [Cursor](https://cursor.sh) — AI-first редактор
- [Beads](https://github.com/hyperdrive-systems/beads) — Git-native таск-менеджер

---

**Полная версия:** `.beads/AGENT_ROLES.md` (1300+ строк с примерами)
