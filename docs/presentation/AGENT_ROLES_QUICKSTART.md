# Роли AI-агентов: Быстрый старт

Минимальная инструкция для начала работы с AI-агентами.

---

## Ключевой принцип: Один Architect управляет всеми

```
┌─────────────────────────────────────────────────────┐
│                    ARCHITECT                         │
│            (Claude Opus / GPT-4 / Gemini)           │
│                                                     │
│  - Читает документацию и требования                 │
│  - Составляет промпты для других агентов            │
│  - Координирует работу                              │
│  - НЕ пишет код сам                                 │
└───────────────────┬─────────────────────────────────┘
                    │
        ┌───────────┼───────────┐
        │           │           │
   ┌────▼────┐ ┌────▼────┐ ┌────▼────┐
   │Developer│ │Developer│ │Reviewer │
   │ (Opus)  │ │ (Opus)  │ │(Gemini) │
   └─────────┘ └─────────┘ └─────────┘
```

---

## 3 роли (минимум для старта)

## Формула успеха: 3 компонента

```
┌─────────────────────────────────────────────────────┐
│  1. Роль + ссылка на AGENT_ROLES.md                 │
│  2. Memory Bank (activeContext, progress)           │
│  3. Короткие чёткие инструкции от Architect         │
└─────────────────────────────────────────────────────┘
```

Эта комбинация даёт максимальный эффект. Architect не просто планирует — он составляет готовые промпты для Developer и Reviewer с учётом контекста.

---

### 1. Architect (Архитектор)

**Кто:** Claude Opus 4.5 / GPT-4o

**Что делает:**
- Читает документацию и Memory Bank
- Составляет план с шагами
- Готовит промпты для Developer и Reviewer
- НЕ пишет код

**Промпт для Architect (планирование):**

```
Ты — Architect. Роль: .beads/AGENT_ROLES.md

Нужно добавить функциональность <X>.

1) Прочитай .memory_bank/productContext.md и activeContext.md
2) Найди релевантные разделы в .memory_bank/modules/
3) Составь пошаговый план:
   - шаг
   - ожидаемый результат
   - файлы, которые будут затронуты
   - риски/неопределённости

Не реализуй ничего. Только план.
```

**Когда план утверждён, Architect готовит промпты:**

```
### Подзадача 1: Извлечь CombatSystem

Промпт для Developer:
"Создай server/src/systems/combatSystem.ts.
Перенеси методы: handleBite, processPvPCollision, applyDamage.
Ограничения: использовать Rng, не Math.random().
Критерий: npm run test проходит."

Промпт для Reviewer:
"Проверь: детерминизм сохранён, порядок систем не изменён,
hardcoded констант нет."
```

### 2. Developer (Разработчик)

**Кто:** Claude Opus / Sonnet / Cursor

**Что делает:**
- Получает готовый промпт от Architect
- Пишет код в своей ветке
- Обновляет Memory Bank
- Создаёт PR

**Промпт для Developer (реализация):**

```
Ты — Developer. Роль: .beads/AGENT_ROLES.md

План утверждён. Выполняй шаг 1.

После выполнения:
- опиши, что сделано
- укажи изменённые файлы
- обнови .memory_bank/activeContext.md и progress.md
```

### 3. Reviewer (Ревьюер)

**Кто:** ChatGPT / Gemini / Copilot (другая модель!)

**Что делает:**
- Получает от Architect что именно проверять
- Запускает тесты
- Публикует отчёт в PR
- Даёт вердикт

**Промпт для Reviewer (проверка):**

```
Ты — Reviewer. Роль: .beads/AGENT_ROLES.md

Проверь PR: [ссылка]

Специфичные проверки от Architect:
- [что именно проверить в этом PR]

Стандартный чеклист:
- [ ] npm run build проходит
- [ ] npm run test проходит
- [ ] Нет hardcoded констант

Формат отчёта в PR:
## Review by [модель]
### Чеклист
### Замечания (P0-P3)
### Вердикт: APPROVED / CHANGES_REQUESTED
```

---

## Настройка среды

### VS Code / Cursor

**Расширения:**
- Claude Dev / Continue (для Claude API)
- GitHub Copilot (опционально)

**Файл настроек: `.vscode/settings.json`**
```json
{
  "claude.apiKey": "${env:ANTHROPIC_API_KEY}",
  "claude.model": "claude-opus-4-5-20251101"
}
```

### Файлы конфигурации проекта

```
project/
├── CLAUDE.md              ← Главные правила для агентов
├── .beads/
│   └── AGENT_ROLES.md     ← Полные инструкции по ролям
├── .memory_bank/
│   ├── activeContext.md   ← Текущее состояние
│   └── techContext.md     ← Технический стек
└── docs/
    └── architecture.md    ← Архитектура проекта
```

### CLAUDE.md (минимальный шаблон)

```markdown
# [Название проекта] — инструкции для Claude

## Главные правила
1. Работай по задачам (Beads / GitHub Issues)
2. Пуш в main запрещён — только через PR
3. После изменений: npm run build && npm run test

## Архитектура
- [Краткое описание]
- Клиент: [технологии]
- Сервер: [технологии]

## Критичные ограничения
- [Ограничение 1]
- [Ограничение 2]

## Ключевые файлы
| Файл | Назначение |
|------|------------|
| [путь] | [описание] |
```

---

## Workflow на практике

### Шаг 1: Architect получает задачу

```
Пользователь → Architect:
"Добавь авторизацию через JWT"
```

### Шаг 2: Architect анализирует и составляет промпт

```
Architect анализирует:
- docs/architecture.md
- server/src/auth/ (если есть)
- Существующие паттерны

Architect создаёт промпт для Developer:
"Создай JWT авторизацию:
1. Файл: server/src/auth/jwt.ts
2. Методы: generateToken(), verifyToken()
3. Использовать: jsonwebtoken из package.json
4. Тесты: server/tests/auth/jwt.test.ts"
```

### Шаг 3: Developer выполняет

```bash
# Developer создаёт ветку
git checkout -b feature/jwt-auth

# Пишет код по промпту
# ...

# Проверяет
npm run build
npm run test

# Создаёт PR
git push -u origin feature/jwt-auth
gh pr create --title "feat: JWT authentication"
```

### Шаг 4: Reviewer проверяет

```
Reviewer получает PR, проверяет по чеклисту,
публикует отчёт в PR:

## Review by Gemini 2.5 Pro

### Чеклист
- [x] Код компилируется
- [x] Тесты проходят
- [ ] Нет hardcoded секретов

### Замечания
1. [P1] jwt.ts:15 — JWT_SECRET захардкожен

### Вердикт
CHANGES_REQUESTED
```

### Шаг 5: Developer исправляет, Reviewer одобряет

### Шаг 6: Человек мержит PR

---

## Чеклист для каждой роли

### Architect (перед составлением промпта)

```
[ ] Прочитал документацию проекта
[ ] Понял текущее состояние (Memory Bank)
[ ] Определил файлы для изменения
[ ] Указал ограничения в промпте
[ ] Указал критерии готовности
```

### Developer (перед коммитом)

```
[ ] Проверил git branch (правильная ветка?)
[ ] npm run build проходит
[ ] npm run test проходит
[ ] Нет hardcoded констант
[ ] Коммит создан, PR открыт
```

### Reviewer (перед вердиктом)

```
[ ] Запустил build и tests
[ ] Проверил соответствие требованиям
[ ] Указал приоритеты замечаний (P0-P3)
[ ] Дал чёткий вердикт (не "наверное ОК")
```

---

## Типичные ошибки

| Ошибка | Почему плохо | Как избежать |
|--------|--------------|--------------|
| Агент пушит в main | Ломает историю | Branch protection в GitHub |
| Агент не проверяет ветку | Коммит в чужую ветку | Pre-flight чеклист |
| Один агент на всё | Пропускает ошибки | Разные модели для ревью |
| Нет документации | Агент галлюцинирует | CLAUDE.md + Memory Bank |
| Забыл тесты | Регрессии | npm run test в чеклисте |

---

## Параллельная работа (Git Worktrees)

Для 2+ агентов одновременно:

```bash
# Создать изолированные рабочие директории
git worktree add ../project-agent1 -b feature/task1
git worktree add ../project-agent2 -b feature/task2

# Агент 1 работает в ../project-agent1
# Агент 2 работает в ../project-agent2
# Конфликтов нет — разные ветки и директории

# После завершения — удалить worktrees
git worktree remove ../project-agent1
git worktree remove ../project-agent2
```

---

## Стоимость

| Сервис | Роль | Цена/мес |
|--------|------|----------|
| Claude API (Opus) | Architect, Developer | $20-50 |
| ChatGPT Plus | Reviewer | $20 |
| Gemini Pro | Reviewer | Бесплатно |
| Copilot | Developer | $10-19 |
| **Итого** | | **$50-100** |

---

## Ссылки

**Статьи (рекомендуемое чтение):**

- [Живая документация проекта через VS Code + Codex + Memory Bank](https://habr.com/ru/articles/979624/) — ключевая статья о методологии
- [Представляем Beads: система памяти для кодинг-агентов](https://habr.com/ru/articles/983498/) — важнейшая статья о сохранении контекста

**Инструменты:**

- [Claude Code](https://claude.ai/claude-code) — CLI для Claude
- [Cursor](https://cursor.sh) — AI-first редактор
- [Beads](https://github.com/hyperdrive-systems/beads) — Git-native таск-менеджер

---

**Полная версия:** `.beads/AGENT_ROLES.md` (1300+ строк с примерами)

---

## Глоссарий

| Термин | Определение |
|--------|-------------|
| **AI-агент** | Языковая модель, выполняющая задачи по инструкциям |
| **Architect** | Роль агента: планирует, составляет промпты, не пишет код |
| **Developer** | Роль агента: пишет код по инструкциям Architect |
| **Reviewer** | Роль агента: проверяет код, даёт вердикт |
| **Memory Bank** | Внешняя память проекта — файлы `.memory_bank/` |
| **PR** | Pull Request — запрос на слияние изменений |
| **Worktree** | Изолированная рабочая директория Git |
| **P0-P3** | Приоритеты замечаний: P0 — критично, P3 — мелочь |
