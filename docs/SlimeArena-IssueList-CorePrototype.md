На основе «Плана разработки v1.6», «Архитектуры v1.3» и «GDD v2.3» я составил детальный список задач (Issue List) для этапа **Прототип ядра (Core Prototype)**.

Этот список фокусируется на проверке ключевого цикла: движение, физика, сбор ресурсов и базовый бой.

------

### Эпик 1: Инфраструктура и Серверное ядро (Server Core)

**Цель:** Запустить симуляцию мира на частоте 30 Гц и наладить сетевой обмен.

- **TASK-01: Инициализация репозитория и монорепозитория**
  - **Описание:** Настроить структуру папок (`server`, `client`, `shared`) и базовый `package.json`. Настроить Docker Compose для локальной разработки.
  - **Критерии приемки:**
    - Команды `npm install` и `npm run dev` запускают сервер и клиент.
    - Настроены линтеры и TypeScript конфиги.
- **TASK-02: Настройка Colyseus Room и Game Loop**
  - **Описание:** Реализовать класс `MatchRoom` и игровой цикл с фиксированным шагом (`simulationInterval` 33.33 мс = 30 Гц).
  - **Критерии приемки:**
    - Сервер логирует тики.
    - Метрика `tick_duration` не превышает 30 мс на пустой комнате.
    - Порядок выполнения систем детерминирован (Input -> Move -> Phys -> Collision -> ...).
- **TASK-03: Система валидации ввода (Input System)**
  - **Описание:** Прием команд от клиента: `seq`, `move` (вектор), `abilitySlot`. Валидация вектора движения: $x^2 + y^2$ (без корня).
  - **Критерии приемки:**
    - Игнорируются инпуты с неверным `seq`.
    - Векторы длиной > 1.01 нормализуются сервером.

------

### Эпик 2: Физика и Движение (Physics & Movement)

**Цель:** Реализовать «приятное» управление с инерцией и дрифтом.

- **TASK-04: Базовое движение и инерция**
  - **Описание:** Реализовать интеграцию движения. Слайм разворачивается к вектору джойстика с ограничением скорости поворота.
  - **Конфиг:** `slimeLinearDamping` (0.02), `maxTurnRate`.
  - **Критерии приемки:**
    - Слайм не меняет направление мгновенно.
    - При отпускании джойстика слайм плавно останавливается (damping).
- **TASK-05: Механика Дрифта (Drift)**
  - **Описание:** При резком развороте (>120°) включать режим дрифта: потеря 50% скорости, длительность 0.3 сек.
  - **Критерии приемки:**
    - Срабатывает только при угле > `driftThresholdAngle`.
    - Соблюдается кулдаун дрифта (0.5 сек).
- **TASK-06: Борты арены (Elastic Walls)**
  - **Описание:** Прямоугольная карта. При выходе за границу — коррекция позиции внутрь и отражение вектора скорости по нормали.
  - **Критерии приемки:**
    - Объект не покидает пределы `worldSize`.
    - Угол падения равен углу отражения (с учетом `restitution`).
- **TASK-07: Система столкновений (Collision System)**
  - **Описание:** Broadphase (сетка или простой перебор для MVP) + Narrowphase (круг-круг). Разрешение коллизий через сохранение импульса.
  - **Важно:** Ограничение импульса `collisionImpulseCap` и постепенное гашение превышения скорости (`speedDampingRate`).
  - **Критерии приемки:**
    - Слаймы отталкиваются друг от друга.
    - Легкие отлетают сильнее тяжелых.
    - Нет «слипания» объектов.

------

### Эпик 3: Игровая логика (Game Logic)

**Цель:** Реализовать рост, поедание и базовый бой.

- **TASK-08: Спавн пузырей и параметры**
  - **Описание:** Спавнить пузыри до лимита (150 шт). У пузырей есть `mass`, `colorId` и `density` (влияет на физику, но не на питание).
  - **Критерии приемки:**
    - Золотые пузыри (density 1.5) тяжелее сдвинуть, чем зеленые (density 0.8).
- **TASK-09: Логика поедания (Eating)**
  - **Описание:** Если пасть касается пузыря: проверка `eatingPower`. Либо полное поглощение, либо откусывание `biteFraction`.
  - **Критерии приемки:**
    - Масса слайма растет.
    - Пузырь уменьшается или исчезает.
    - Остаток пузыря отлетает (импульс).
- **TASK-10: Боевая система (Combat)**
  - **Описание:** Определение зон удара (Пасть/Хвост/Бок) по углам относительно `heading`. Расчет урона и применение I-frames (0.2 сек).
  - **Критерии приемки:**
    - Удар пастью в хвост наносит x1.5 урона.
    - Боковые столкновения не наносят урон (только отскок).
- **TASK-11: Смерть и Респаун**
  - **Описание:** При HP <= 0: переход в состояние смерти. Потеря 50% массы (30% выпадает пузырями). Респаун через 2 сек с щитом на 5 сек.
  - **Критерии приемки:**
    - Слайм исчезает и появляется в безопасном месте.
    - Под щитом урон не проходит.

------

### Эпик 4: Клиент и Синхронизация (Client Core)

**Цель:** Отобразить то, что происходит на сервере, без лагов.

- **TASK-12: Базовый рендеринг (Canvas 2D)**
  - **Описание:** Отрисовка кругов (слаймы, пузыри) и границ карты. Камера центрируется на игроке, масштаб зависит от массы.
  - **Критерии приемки:**
    - Видно различие между пастью и хвостом (визуальный маркер).
    - FPS стабилен (60 кадров).
- **TASK-13: Буфер снапшотов и Интерполяция**
  - **Описание:** Клиент хранит буфер снапшотов. Рендер происходит с задержкой (`interpolationDelay`). Использовать интерполяцию Эрмье для сглаживания.
  - **Критерии приемки:**
    - Движение других игроков плавное, без рывков.
    - При потере 1-2 пакетов нет визуальных артефактов.
- **TASK-14: Управление (Input Controller)**
  - **Описание:** Реализовать адаптивный джойстик (появляется под пальцем в левой части экрана). Отправка инпутов на сервер 30 раз в секунду.
  - **Критерии приемки:**
    - Джойстик не «слетает» при выходе пальца за границы зоны.
    - Касания правой части экрана не сбивают движение.
- **TASK-15: Минимальный UI и Game Loop**
  - **Описание:** HUD с текущей массой/HP. Экран «Game Over» с кнопкой «Респаун» (локальный цикл матча).
  - **Критерии приемки:**
    - Игрок видит, что умер.
    - Можно перезайти в матч/возродиться.

------

### Следующий шаг для вас:

Хотите, я сгенерирую **JSON-конфиг баланса** (`config/balance.json`), который потребуется для задач **TASK-04** (физика) и **TASK-09** (поедание), заполнив его значениями по умолчанию из GDD?