# Тестирование Telegram Mini App (туннель и Wi‑Fi)

Цель: быстро открыть клиент **внутри Telegram** для проверки `TelegramAdapter` (реальный `window.Telegram.WebApp.initData`) и иметь запасной способ тестирования **только по локальной сети**.

## Вариант A — быстро и надёжно: HTTPS‑туннель (рекомендуется)

Этот способ открывает игру **внутри Telegram**, потому что даёт публичный HTTPS‑адрес.

### 1) Запуск клиента

В репозитории:

- `npm run dev:client`

Обычно это `http://localhost:5173`.

### 2) Туннель Cloudflare (Windows)

Установка:

- `winget install Cloudflare.cloudflared`

Запуск туннеля:

- `cloudflared tunnel --url http://localhost:5173`

В выводе появится адрес вида `https://<что‑то>.trycloudflare.com`.

### 3) Настройка бота в Telegram

Нужен обычный Telegram‑аккаунт. Отдельный «аккаунт разработчика» не требуется.

- Создать бота через @BotFather: `/newbot`
- Разрешить домен WebApp:
  - `/setdomain`
  - домен: `trycloudflare.com` (без `https://`, без пути)
- Установить кнопку меню для WebApp:
  - `/setmenubutton`
  - выбрать бота
  - указать WebApp URL: `https://<что‑то>.trycloudflare.com`

### 4) Проверка

- Открыть чат с ботом → нажать кнопку меню → игра откроется во встроенном окне Telegram.

### Замечания безопасности

- URL временный и меняется при перезапуске туннеля.
- Не публиковать ссылку широко: это доступ к вашему dev‑серверу.

---

## Вариант B — только локальная сеть по Wi‑Fi

Ниже два подварианта:

- **B1 (простой):** тестирование в обычном браузере на телефоне по Wi‑Fi.
- **B2 (сложный):** попытка открыть **внутри Telegram** по локальной сети (почти всегда упирается в HTTPS/сертификаты).

### B1) Телефон → браузер → локальный IP

Подходит для UI/верстки/управления, но **не проверяет `TelegramAdapter`**.

1) Запусти dev‑сервер Vite так, чтобы он слушал внешние подключения:

- `npm run dev:client -- --host 0.0.0.0 --port 5173`

2) Узнай локальный IP ПК:

- `ipconfig`

Ищи IPv4 вида `192.168.x.x`.

3) Открой на телефоне (в той же Wi‑Fi сети) в браузере:

- `http://<ip‑пк>:5173`

4) Если не открывается:

- Проверь, что ПК и телефон в одной сети.
- Разреши входящие подключения в брандмауэре Windows для порта `5173`.

### B2) Телефон → Telegram → локальная сеть

Практически всегда Telegram WebApp ожидает **HTTPS** и домен из разрешённого списка. `http://192.168.x.x:5173` обычно не подходит.

Если очень нужно именно «внутри Telegram» без внешнего интернета, то минимальный набор требований:

- локальный домен (не IP), который открывается на телефоне (например, через DNS роутера или hosts на телефоне)
- HTTPS на этом домене
- сертификат, который телефон доверяет (самоподписанные часто не проходят в WebView)

Из‑за сложности и хрупкости этого пути, для быстрых проверок рекомендуется Вариант A (туннель).

---

## Что именно проверять внутри Telegram

Короткий чек‑лист:

- Игра открывается внутри Telegram (не отдельный браузер)
- `TelegramAdapter` доступен, нет ошибок про `Telegram WebApp недоступен`
- Кнопки умений: иконки/слоты/кулдауны корректны
- Results: тексты кнопок и иконки классов отображаются правильно
- HUD: safe‑area не перекрывает верхние элементы
