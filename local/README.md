# Архитектура проекта Slime Arena

Данный документ является основным источником информации об архитектуре проекта.

## Обзор подсистем

Проект организован как монорепозиторий с разделением на следующие ключевые подсистемы:

1.  **Server (`/server`)**:
    *   **Технологии**: Node.js, Colyseus.
    *   **Роль**: Authoritative server (источник истины). Управляет состоянием игры, физикой и сетевыми подключениями.
    *   **Точка входа**: `server/src/index.ts`.
    *   **Логика комнат**: `server/src/rooms/ArenaRoom.ts`.

2.  **Client (`/client`)**:
    *   **Технологии**: Vite, HTML5 Canvas 2D.
    *   **Роль**: Визуализация состояния игры, обработка ввода пользователя, интерполяция снапшотов.
    *   **Точка входа**: `client/src/main.ts`.

3.  **Shared (`/shared`)**:
    *   **Роль**: Общий код, используемый и клиентом, и сервером. Содержит типы данных, константы, математические формулы и логику парсинга конфигураций.

4.  **Config (`/config`)**:
    *   **Роль**: Централизованное хранение игрового баланса в формате JSON (`balance.json`).

## Ключевые модули

### Серверные модули
*   **ArenaRoom**: Основной игровой цикл, управление фазами матча.
*   **Systems**: Набор систем (Physics, Collision, FlightAssist, Pickup, Combat), выполняющихся каждый тик.
*   **Rng**: Детерминированный генератор случайных чисел.

### Клиентские модули
*   **Rendering**: Модуль отрисовки сущностей на Canvas (`client/src/rendering/`).
*   **Input**: Обработка управления (джойстик, клавиатура) (`client/src/input/`).
*   **Snapshot Buffer**: Управление очередью состояний от сервера для плавной интерполяции.

## Связи между подсистемами

1.  **Сетевое взаимодействие**: Клиент подключается к серверу через WebSockets (протокол Colyseus). Клиент отправляет команды ввода (`InputCommand`), сервер транслирует изменения состояния (`GameState`).
2.  **Общая логика**: И клиент, и сервер импортируют типы и утилиты из `@slime-arena/shared`.
3.  **Конфигурация**: Сервер загружает `config/balance.json` при старте и передает необходимые параметры клиенту (или клиент использует дефолты из shared).
4.  **Ресурсы**: Клиент загружает спрайты из корневой папки `assets/` (через проксирование или статику).

## Инфраструктура и CI/CD
*   **Docker**: Контейнеризация сервера и клиента (`docker/`).
*   **GitHub Actions**: Автоматическая сборка и тесты детерминизма (`.github/workflows/`).

---
*Примечание: Данный файл синхронизирован с Memory Bank проекта.*
